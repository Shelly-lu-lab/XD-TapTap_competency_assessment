<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心动&TapTap 岗位能力模型（内测版）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="oauth-config.js"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .competency-card, .analysis-section {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-button {
            border: 2px solid #3b82f6;
            color: #3b82f6;
            background-color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .file-input-button:hover {
            background-color: #eff6ff;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* 确保容器在所有屏幕尺寸下都能正确利用屏幕空间 */
        @media (min-width: 1536px) {
            .max-w-7xl {
                max-width: 80rem;
            }
        }
        
        @media (min-width: 1280px) and (max-width: 1535px) {
            .max-w-7xl {
                max-width: 75rem;
            }
        }
        
        @media (min-width: 1024px) and (max-width: 1279px) {
            .max-w-7xl {
                max-width: 70rem;
            }
        }
        
        @media (min-width: 768px) and (max-width: 1023px) {
            .max-w-7xl {
                max-width: 60rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- OAuth Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-2xl font-bold text-gray-800">登录验证</h3>
                <button id="closeLoginModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl font-bold">&times;</button>
            </div>
            <div class="mt-6 text-center">
                <div class="mb-6">
                    <div class="w-16 h-16 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">统一身份认证</h4>
                    <p class="text-sm text-gray-600">请使用公司统一身份认证系统登录</p>
                </div>
                <button id="loginBtn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition shadow-lg">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    使用SSO登录
                </button>
                <div class="mt-4 text-xs text-gray-500">
                    登录后将自动跳转到应用主页
                </div>
            </div>
        </div>
    </div>

    <!-- User Info Header -->
    <div id="userInfoHeader" class="bg-white shadow-sm border-b border-gray-200 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <span id="userName" class="text-sm font-medium text-gray-800"></span>
                        <span id="userEmail" class="text-xs text-gray-500 ml-2"></span>
                    </div>
                </div>
                <button id="logoutBtn" class="text-sm text-gray-500 hover:text-gray-700 transition">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    退出登录
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-6 xl:px-8 py-4 md:py-8">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">心动&TapTap 岗位能力模型（内测版）</h1>
            <p class="text-gray-600 mt-2">请选择职位序列和职级，以生成对应的能力模型。您可以对生成的结果进行调整。</p>
        </header>

        <!-- Selection Controls Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8 sticky top-4 z-10 border border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="primarySequence" class="block text-sm font-medium text-gray-700 mb-1">一级序列</label>
                    <select id="primarySequence" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">请选择</option>
                    </select>
                </div>
                <div>
                    <label for="secondarySequence" class="block text-sm font-medium text-gray-700 mb-1">二级序列</label>
                    <select id="secondarySequence" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" disabled>
                        <option value="">请选择</option>
                    </select>
                </div>
                <div>
                    <label for="jobLevel" class="block text-sm font-medium text-gray-700 mb-1">专业职级</label>
                    <select id="jobLevel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" disabled>
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- REVERTED & IMPROVED: Resume Input Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8 border border-gray-200">
            <label for="resumeText" class="block text-lg font-semibold text-gray-800 mb-2">候选人简历正文 (可选)</label>
            <p class="text-sm text-gray-500 mb-3">在此处粘贴候选人简历的<strong class="text-blue-600">正文内容</strong>，生成面试问题时将结合简历进行个性化提问。</p>
            <textarea id="resumeText" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition custom-scrollbar" placeholder="例如：张三，2020-至今 在XX公司担任高级产品经理，负责XX项目..."></textarea>
        </div>


        <!-- Competency Display Section -->
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-6 lg:gap-8 items-stretch">
            <!-- Competency cards will be dynamically inserted here -->
            <div id="placeholder" class="md:col-span-2 lg:col-span-2 xl:col-span-2 text-center py-16 px-6 bg-white rounded-xl shadow-md border border-gray-200">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2z" />
                </svg>
                <h3 class="mt-2 text-lg font-medium text-gray-900">请先选择岗位信息</h3>
                <p class="mt-1 text-sm text-gray-500">完成选择后，这里将展示对应的能力要求。</p>
            </div>
        </div>
        
        <!-- Add Competency Button -->
        <div id="addCompetencyBtnContainer" class="mt-8 text-center hidden">
            <button id="addCompetencyBtn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition shadow-sm">
                + 新增能力项
            </button>
        </div>

        <!-- NEW: Interview Analysis Section -->
        <div id="analysisSection" class="analysis-section mt-12 bg-white p-6 rounded-xl shadow-md border border-gray-200 hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">面试后AI评估</h2>
            <div class="border-b border-gray-200 mb-4">
                <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                    <button id="tab-text" class="tab-button active">粘贴面试全文</button>
                    <button id="tab-audio" class="tab-button">上传面试录音 (模拟)</button>
                </nav>
            </div>

            <div id="content-text" class="tab-content active">
                <p class="text-sm text-gray-500 mb-3">请将面试记录的<strong class="text-blue-600">纯文本</strong>粘贴到下方，然后点击评估按钮。</p>
                <textarea id="interviewTranscript" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition custom-scrollbar" placeholder="例如：面试官：请您做一个自我介绍...&#10;候选人：您好，我叫..."></textarea>
            </div>

            <div id="content-audio" class="tab-content">
                 <p class="text-sm text-gray-500 mb-4">此功能为演示界面，未来可集成语音转文字服务。请切换到“粘贴面试全文”标签页使用核心功能。</p>
                <div class="flex items-center gap-4">
                    <div class="file-input-wrapper">
                        <button class="file-input-button">选择音频文件</button>
                        <input type="file" id="audioFile" accept="audio/*" disabled>
                    </div>
                     <span class="text-gray-500">尚未选择文件</span>
                </div>
            </div>

            <div class="mt-6 text-center">
                <button id="startAnalysisBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition shadow-lg">
                    开始AI评估
                </button>
            </div>

            <div id="analysisResultContainer" class="mt-8"></div>
        </div>

    </div>

    <!-- Modal for adding new competency -->
    <div id="addCompetencyModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-20">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-xl bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-2xl font-bold">添加能力项</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl font-bold">&times;</button>
            </div>
            <div class="mt-5">
                <input type="text" id="modalSearch" placeholder="搜索能力项..." class="w-full p-3 border border-gray-300 rounded-lg mb-4">
                <div id="modalCompetencyList" class="max-h-96 overflow-y-auto custom-scrollbar pr-2">
                    <!-- Competency list will be populated here -->
                </div>
            </div>
        </div>
    </div>

<script>
// --- DATA (Embedded from previous steps) ---

const sequencesData = {
    "技术大类 (T)": [
        { name: "技术研发类", code: "S_T_Dev" },
        { name: "安全类", code: "S_T_Sec" },
        { name: "TA类", code: "S_T_TA" },
        { name: "技术运维类", code: "S_T_Ops" },
        { name: "质量管理类", code: "S_T_QA" }
    ],
    "创意大类 (A)": [
        { name: "设计类", code: "S_A_Design" },
        { name: "游戏美术类", code: "S_A_GameArt" },
        { name: "影视类", code: "S_A_Video" },
        { name: "音效设计类", code: "S_A_Audio" },
        { name: "UD/UX类", code: "S_A_UDUX" }
    ],
    "产品大类 (P)": [
        { name: "产品策划类", code: "S_P_ProdPlan" },
        { name: "游戏策划类", code: "S_P_GamePlan" }
    ],
    "运营大类 (O)": [
        { name: "互联网产品运营类", code: "S_O_WebOps" },
        { name: "游戏产品运营类", code: "S_O_GameOps" },
        { name: "内容风控类", code: "S_O_ContentRisk" }
    ],
    "市场商务大类 (S)": [
        { name: "广告媒介类", code: "S_S_Media" },
        { name: "商务拓展类", code: "S_S_BD" },
        { name: "市场品牌类", code: "S_S_Mkt" },
        { name: "广告销售类", code: "S_S_Sales" }
    ],
    "职能大类 (F)": [
        { name: "财务管理类", code: "S_F_Finance" },
        { name: "人力资源类", code: "S_F_HR" },
        { name: "法律类", code: "S_F_Legal" },
        { name: "行政类", code: "S_F_Admin" },
        { name: "公共关系类", code: "S_F_PR" },
        { name: "企业IT类", code: "S_F_IT" },
        { name: "事务类", code: "S_F_Affairs" },
        { name: "综合类", code: "S_F_General" }
    ],
    "项目管理大类 (PM)": [
        { name: "供应商管理类", code: "S_PM_Supplier" },
        { name: "项目管理类", code: "S_PM_Project" }
    ]
};

const levelsData = [
    { name: "入门/学习者 (1)", code: "P_10" },
    { name: "受指导，求独立 (2-1)", code: "P_21" },
    { name: "独立干，输出稳 (2-2)", code: "P_22" },
    { name: "担需求，求品质 (2-3)", code: "P_23" },
    { name: "担目标，定流程，解问题 (3-1)", code: "P_31" },
    { name: "带节奏，解难题，做产品 (3-2)", code: "P_32" },
    { name: "挖深度，定方向，控风险 (3-3)", code: "P_33" },
    { name: "定标准，求创新 (4)", code: "P_40" }
];

const competenciesData = {
    "C_L_101": { name: "1.01 团队领导", levels: { "L1": { name: "告知团队", desc: "• 主动向团队成员传达某项决定的内容或工作任务的要求，清晰地表明工作的原则和权限范围，明确要完成的目标。\n• 以正式的渠道公告授权内容，向团队成员解释其中的过程或原因，确保他们了解必要的信息，帮助他们获得配合和减少冲突。" }, "L2": { name: "维护群体", desc: "• 确保团队的合理需要得到满足，并为团队成员的工作开展争取所需要的各种信息、资源。\n• 保护自己领导的团队及其声誉，以及做出的安排和决定等，确保集体的任务能够完成。\n• 采取各类实质性的举措让团队成员感受到自己对团队利益的重视。" }, "L3": { name: "做好表率", desc: "• 通过以身作则，向团队成员示范自己所期望的行为，使他们接受自己为团队设定的使命和目标。\n• 在必要的时候与下属同甘共苦，赢得下属的信赖。" }, "L4": { name: "激发士气", desc: "• 针对不同的情况，灵活采取不同的激励手段，激发下属的热情。\n• 善于描绘激动人心的使命和目标，使下属充满热情和希望。\n• 采用各种方式来提高团队的士气，如迅速解雇绩效不佳者，对工作流程进行科学、合理的调整等，以改进团队的工作效率，加强集体向心力。" }, "L5": { name: "创造氛围", desc: "• 成为团队的精神领袖，从做事方式上深入影响下属，利用个人人格魅力或突出的工作能力在下属和同事间树立威信。\n• 鼓励团队成员之间互相帮助，创造坦率、温暖、合作的团队氛围。" } } },
    "C_L_102": { name: "1.02 战略规划", levels: { "L1": { name: "战略理解", desc: "• 认识到自己的日常工作与组织战略(由他人制定)的联系，了解短期利益与长远目标间的关系，清楚自己管辖范围内的工作在组织整体发展中的位置和作用。" }, "L2": { name: "战略行动", desc: "• 按照外部或组织战略的要求安排工作的轻重缓急和优先次序，在资源分配方面，向战略发展的重点方向倾斜，不因为短期业绩压力，忽略长期发展战略的要求。" }, "L3": { name: "战略设计", desc: "• 在组织整体战略的大范围内，根据局部区域的特点和条件，设计落实管辖范围内的工作战略。" }, "L4": { name: "战略执行", desc: "• 能够有效抵制与组织战略方向不统一的工作行为。\n• 在当前具体工作安排时要分析短期目标是否有助于实现长期规划，从宏观和整体进行考虑，做出有利于组织长远发展的工作决策。" }, "L5": { name: "战略思维", desc: "• 了解分析社会市场大环境条件的变化和长远发展目标的要求对日常工作可能产生的影响，检讨当前的战略和工作部署。" } } },
    "C_M_201": { name: "2.01 计划执行", levels: { "L1": { name: "明确目标", desc: "• 能够根据公司或上级的明确要求，结合本岗位的职责，确定自己工作的短期目标。" }, "L2": { name: "目标分解", desc: "• 根据具体目标，将工作分解为若干的关键可操作性步骤，设立优先次序，形成任务时间进度表。" }, "L3": { name: "资源配置", desc: "• 能够准确评估实现工作目标所需的人、财、物等资源，并做出资源配置的可行性方案。" }, "L4": { name: "监控与反馈", desc: "• 建立监控和反馈机制，能够从整体上把握计划实施的进程。" }, "L5": { name: "灵活应变", desc: "• 在工作计划中预先考虑预留弹性或额外工作时间，以应对意外事件。\n• 主动评估工作中可能存在的风险，随时准备应对各种障碍和问题，并提前制定应变方案，以确保工作任务总是按时、保质地完成。" } } },
    "C_M_202": { name: "2.02 决策能力", levels: { "L1": { name: "常规决定", desc: "• 在收集到较为充分的信息后，清楚地向团队成员表明自己的要求，并给予他们基本的、例行的指示，但当对一些例外事项或突发事件时，往往需要借助他人力量。" }, "L2": { name: "立场坚定", desc: "• 能够坚持立场，决策时以事实为依据，拒绝他人不合理的要求；\n• 对一些例外事项和突发事件也能独立判断，做出决策。" }, "L3": { name: "全面考虑", desc: "• 面对有竞争性的方案时，能够全面考虑各方意见，细致分析影响因素，认真对比各个备选方案，及时不拖延的做出决定。" }, "L4": { name: "风险决策", desc: "• 能够合理预测决策可能带来的风险，衡量潜在的收益，及时做出抉择，并勇于承担风险。" }, "L5": { name: "长远规划", desc: "• 在复杂、模糊且风险很高的形势下，或能够在大数人反对的情况下仍坚持观点，毫不犹豫地做出对组织有长远影响的有利决策。" } } },
    "C_M_203": { name: "2.03 培养指导", levels: { "L1": { name: "正面评价", desc: "• 相信他人有主动性，并且有能力学会或改进工作，对他人取得的正面成绩或进步行为表示公开赞扬。\n• 对下属目前特点、优势以及成熟度有比较深入的了解，对蕴涵在其身上的潜能和未来前途有肯定的预测和评价。" }, "L2": { name: "传授方法", desc: "• 进行详细的指示或是给予示范，告诉别人如何完成某项任务的具体步骤，提出明确有用的建议。\n• 通常能够针个体不同的特点，采用不同的指导方式，使其掌握完成任务的具体方法。" }, "L3": { name: "分享经验", desc: "• 在做指示或示范时，愿意与他人分享成败的经验，提供为什么要采用某种做法的道理，帮助他人理解以强化培训效果。\n• 利用提问题、测验或其它的方法来判断他人是否理解，以协助其顺利完成任务。" }, "L4": { name: "提供反馈", desc: "• 对他人的工作表现及时给予客观的、有针对性的反馈意见，从而帮助其认识到需要改进的地方或取得进步的方面。\n• 在他人遇到挫折时给予支持和鼓励，针对行为而非个人给予反馈，并对其未来的表现表达出正面期待或给予个别化的改进建议。" }, "L5": { name: "锻炼成长", desc: "• 发现他人需要提高的方面，为其安排有针对性的工作任务、培训项目或其它实践机会。\n• 设计工作改进和培训计划，以促进其学习和成长。\n• 鼓励下属承担有挑战性的任务，在控制风险的前提下充分授权，让他们按照自己的方式完成工作。" } } },
    "C_M_204": { name: "2.04 影响能力", levels: { "L1": { name: "直接说服", desc: "• 采用单一、直接的方法或论据对他人进行说服（如：讲大道理、平铺直叙法、死缠烂打等），试图使他人支持自己的观点或要求对方做出承诺或保证。" }, "L2": { name: "简单多元法", desc: "• 采用两种以上的步骤，或准备多种论据进行说服，但仍然是按照自己的想法进行，没有表现出有意识地针对被影响对象设计影响方式。" }, "L3": { name: "对症下药", desc: "• 善于换位思考，能够根据对方的关注点（如：兴趣、爱好、利益、声誉、顾虑等），把握恰当时机，灵活选择适合对方的说服影响方式，或调整影响的内容和形式。\n• 预先考虑到不同对象的可能反应，提前做出准备或预备方案，期待并准备应付别人可能会产生的反应。" }, "L4": { name: "巧借力法", desc: "• 寻找支持自己观点并能对别人真正产生影响的人物，使用连环套的方式对目标施加影响，如：借助上级力量，游说关键性人物，利用人际关系网络进行间接影响等。" }, "L5": { name: "利益联盟", desc: "• 能够根据情况设计复杂的影响策略，与关键人物结成政治或利益联盟，采用幕后交易的方式获得他们的支持。" } } },
    "C_M_205": { name: "2.05 组织协调", levels: { "L1": { name: "思路明确, 资源到位", desc: "• 了解组织中的资源现状，能基本保证完成工作任务所需的资源按时到位。\n• 有一定的组织活动能力，愿意与人建立联系，但缺乏足够的创意方法，对参与者缺乏吸引力和控制力。" }, "L2": { name: "组织和调动资源", desc: "• 组织各种工作时考虑周到，能根据任务的重要紧急程度，提前分配或调动各种资源。\n• 善于同各方面保持融洽的关系，在兼顾对方利益的基础上促进相互理解、共同合作，保证工作顺利开展。" }, "L3": { name: "调解冲突", desc: "• 组织中出现冲突时具有一定的调解技巧，必要时借助上级或其他力量以保证工作继续开展。\n• 通过及时有效的分配和调动资源，克服由于他人原因引起的延误，圆满解决超出自己控制范围的问题。" }, "L4": { name: "获取支持", desc: "• 工作中常能有新的创意，组织各项工作时有一定の方法和技巧调动参与者的积极性，善于根据工作需要策划出大家喜爱参与，又有利于实现组织目标的活动。" }, "L5": { name: "对外协调", desc: "• 有良好的沟通能力，社会交往面较宽，善于与外界建立合作关系，利用方方面面的资源为工作服务。" } } },
    "C_P_301": { name: "3.01 成本意识", levels: { "L1": { name: "成本估算", desc: "• 能够运用预算工具对工作中可能的成本进行合理估算。" }, "L2": { name: "费用控制", desc: "• 贯彻公司的财务制度，在保证工作质量的前提下，定期监督工作支出状况，将费用控制在预算内。" }, "L3": { name: "避免浪费", desc: "• 对他人的浪费行为，能够进行提醒或劝阻。\n• 敢于挑战并尽量避免可能会使成本增加的一些官僚做法。" }, "L4": { name: "主动节约", desc: "• 总是能够想方设法，积极地以灵活、创新的方式（如优化流程等）改善工作，从而节省成本。" }, "L5": { name: "成本效益分析", desc: "• 能够进行投入和产出分析，在控制成本的基础上，通过尝试识别新的高产出机会，增加有效投入，以实现公司利益的最大化。" } } },
    "C_P_302": { name: "3.02 客户导向", levels: { "L1": { name: "及时回应", desc: "• 耐心倾听客户的咨询、要求和抱怨，及时回应客户的要求，解决常规性的客户问题。" }, "L2": { name: "保持沟通", desc: "• 与客户保持沟通，当客户需要帮助的时候可以随时取得联系。\n• 关注客户の满意度，提供对客户有帮助的信息。" }, "L3": { name: "个性化服务", desc: "• 把客户的明确需求看成是自己的工作任务，为此投入时间和精力去做工作。\n• 当常规产品和服务不能满足客户需要时，为客户提供个性化的产品和服务，尽可能快速准确的解决客户问题。" }, "L4": { name: "挖掘潜在需求", desc: "• 关注和了解客户的潜在需求，致力于开发符合客户需求的产品和服务。" }, "L5": { name: "重视长远利益", desc: "• 担任客户的顾问角色，针对客户的需求、问题提出自己独立的观点，并采取行动解决问题，积极参与帮助客户进行决策。\n• 为客户寻找长期利益，能够采取具体的措施为客户提供增值服务，并借此成功取信于客户。" } } },
    "C_P_303": { name: "3.03 专业性", levels: { "L1": { name: "回答问题", desc: "• 当被问及时作为专家一样回答问题，会告诉别人他对一些技术问题的理解。" }, "L2": { name: "额外帮助", desc: "• 尽力回答更深入的问题，并花时间告诉他人额外的知识，帮助他们解决技术问题，或帮助其影响客户。" }, "L3": { name: "技术顾问", desc: "• 像一位技术顾问一样，主动提供个人的专业知识，寻找机会帮助人们解决技术难题或提升技术水平。" }, "L4": { name: "内部传播", desc: "• 作为技术工作人员向他人介绍新技术，想要新的的技术在公司范围内得到认可。" }, "L5": { name: "外部传播", desc: "• 想办法向外部传播专业知识：在专业性杂志上发表文章，公开演讲，使新的知识、技术广为人知。" } } },
    "C_T_401": { name: "4.01 创新能力", levels: { "L1": { name: "经验推断", desc: "• 当面对新挑战时，通常利用以往经验，或者参照系统内部的观点进行推断。" }, "L2": { name: "创新思考", desc: "• 主动关注身边发生的新技术和新方法，与现有事物进行比较，发现其中的差异所在。\n• 思考新技术或新问题对自己工作可能产生的影响。" }, "L3": { name: "挑战现状", desc: "• 不断对现有事物提出问题，挑战传统的工作方法和思维方式。\n• 对本职工作的改善有自己的见解，不断引入其它领域的观念和方法来指导工作。\n• 敢于为制定新政策、采取新措施或尝试新方法承担风险。" }, "L4": { name: "推陈出新", desc: "• 尝试新的事物，而且通过自己的判断进行合理使用，降低风险。\n• 改进现有的方案，找到更好更有效的工作方式或产品。" }, "L5": { name: "发明创造", desc: "• 形成和运用新的概念，创造出全新的工作方法或产品。\n• 拥有市场上的新发明，或能够建立获得社会认可的理论体系，可以指导并提高绩效。" } } },
    "C_T_402": { name: "4.02 分析式思维", levels: { "L1": { name: "分解问题", desc: "• 将问题分解为各项独立的互不联系的任务或活动，并罗列出来。" }, "L2": { name: "简单因果", desc: "• 将问题分解为简单关联的若干部分，认识到简单直接的因果关系（单因单果）。\n• 进行黑白分明的选择（支持或反对，接受或拒绝等）。" }, "L3": { name: "多因多果", desc: "• 将问题或事物分解成相互关联的若干部分，认识到简单的多重因果关系（一因多果，多因一果的简单因果链）。" }, "L4": { name: "全面判断", desc: "• 将问题或事物分解成相互关联且重要性不等的若干部分，认识到复杂因果链。\n• 能够对某种原因或结果的可能性和重要性进行分析，衡量不同行动方法的价值。" }, "L5": { name: "未雨绸缪", desc: "• 预测可能的障碍，并事先设想接下来解决问题的步骤。\n• 能事先想出几个解决问题的方案，在权衡轻重、利弊和可能性的基础上，对不同方案进行判断和选择。" } } },
    "C_T_403": { name: "4.03 归纳思维", levels: { "L1": { name: "照搬套用", desc: "• 能够运用浅显的规律（经验法则）和普通常识确定问题所在。\n• 当所面临的情况与以前经历过的情况相同时，能够识别出共同之处并应用以前的经验。" }, "L2": { name: "模式识别", desc: "• 面对不完全相同的现象和问题时，可以认识到不同事物（如所面临的情况与以前经历过的情况）之间的相似之处。" }, "L3": { name: "整体方法", desc: "• 利用学习到的理论知识，以及在处理其它问题时取得的经验，对现有问题进行整体分析和处理。" }, "L4": { name: "化繁为简", desc: "• 面对复杂的情况时，能将各种观点、问题和搜索到的数据归纳提炼出核心的观点或简洁的结论。" }, "L5": { name: "独具慧眼", desc: "• 在处理问题时，能够用自己创造的概念来反映各个事物间的内在联系并指导问题的解决。\n• 在处理问题中能够发现别人没有发现的关键点，透过表面，深入问题的本质，总结出规律。" } } },
    "C_T_404": { name: "4.04 信息收集", levels: { "L1": { name: "打听消息", desc: "• 面临困难任务时，想到要尽可能收集多方面的信息来解决问题。\n• 直接询问相关知情人员，获得现成的信息来源，并花时间汇集资料。" }, "L2": { name: "调查情况", desc: "• 亲自去现场对情况进行观察，询问相关人员，收集有用的信息。" }, "L3": { name: "挖掘真相", desc: "• 接触其他尽可能多的渠道或对象，获得他们的观点、背景资料及经验等各种相关或潜在相关的信息。\n• 不满足于表面信息的获得，能深入询问，挖掘问题的核心和真相。" }, "L4": { name: "系统研究", desc: "• 形成收集信息的习惯，建立起能够长期运作的信息收集系统。\n• 对收集到的信息进行系统分类、整理和保存等方面的管理。" }, "L5": { name: "情报系统", desc: "• 建立相关的信息收集系统，通过系统的正式研究渠道（如报纸、杂志等）来获取信息。\n• 长期不间断地使用自己的系统方法收集信息，并不断挖掘未来的潜在信息和信息收集途径。" } } },
    "C_T_405": { name: "4.05 学习领悟", levels: { "L1": { name: "学习积累", desc: "• 对别人身上的闪光点或者好的做法，即使目前不使用，也记录和积累下来。\n• 多向有经验的人学习好的想法和好的做法。" }, "L2": { name: "直接运用", desc: "• 将别人明确表述的经验和做法，应用到工作中。" }, "L3": { name: "举一反三", desc: "• 对别人明确表述的经验和做法加以调整修改，运用于解决不同的问题。" }, "L4": { name: "融会贯通", desc: "• 将各方面知识的精髓融为一体，得到处理不同问题的通则或经验方法，并将之变为自己的东西，用它来分析现实中的工作问题，提出有效的解决办法。" }, "L5": { name: "提炼升华", desc: "• 从经历的偶发体验或事件中，亲自总结出解决问题的方法并加以运用。" } } },
    "C_I_501": { name: "5.01 成就动机", levels: { "L1": { name: "表达意愿", desc: "• 表现出把工作做好的愿望。\n• 对浪费和低效率感到不满和沮丧（例如，抱怨浪费时间、资源等）。" }, "L2": { name: "符合标准", desc: "• 工作表现符合公司制定的管理标准。" }, "L3": { name: "制定标准", desc: "• 为自己制定衡量进步的具体的客观标准（譬如自己要把工作成绩做到前十名或者像某个榜样那样）。" }, "L4": { name: "改善绩效", desc: "• 根据所制定的进步标准，对现有的工作方法和内容进行改进，以提高工作绩效。" }, "L5": { name: "挑战目标", desc: "• 为自己制定具有挑战性的目标并采取具体行动去实现目标（“挑战性”是指尽了很大的努力后，成功的可能性为80%左右的目标，如同类人员中的优秀标准）。" } } },
    "C_I_502": { name: "5.02 沟通能力", levels: { "L1": { name: "愿意沟通", desc: "• 有沟通的愿望，能够回应他人发出的沟通信号。" }, "L2": { name: "准确表达", desc: "• 能够耐心倾听他人的观点，基本把握他人谈话的主旨。\n• 能比较完整地表达自己的意见和想法，使对方能够理解。" }, "L3": { name: "高效沟通", desc: "• 在与他人交流时能够准确理解他人的观点，积极地给予反馈。\n• 表达言简意赅，具有较强的逻辑性，观点清晰明确。" }, "L4": { name: "注重技巧", desc: "• 通过一些语言技巧（如使用比喻、排比等）清晰地表达较为深奥而复杂的观点。\n• 在表达时有意识地使用一些肢体语言作为辅助，增加语言表达的感染力。" }, "L5": { name: "设计策略", desc: "• 预见到他人的需要和关注点，根据不同对象采取相应的沟通策略。\n• 对不同对象和情境所要求的沟通方式有系统和深入的认识，并能自如地运用和进行灵活调整。" } } },
    "C_I_503": { name: "5.03 关注细节", levels: { "L1": { name: "行事规范", desc: "• 对自己的工作要求严格，都会按照既定的操作规范或上级指示进行，较少出现错误。" }, "L2": { name: "主动检查", desc: "• 注重对自己的工作进行检查，以核实提供的资料和信息的真实性。" }, "L3": { name: "多方验证", desc: "• 在提供资料或信息前，能够主动通过多种途径，对其真实性进行交叉验证。" }, "L4": { name: "监控他人", desc: "• 注意督促下属或配合自己工作的其他人员对工作的各个环节进行多角度、全方位的考虑，确保工作准确无误。\n• 能够对他人的工作的细节进行要求或检查，发现或纠正其工作中的差错和疏忽等。" }, "L5": { name: "运用系统", desc: "• 学习并督促自己及他人掌握各种可以提升和改进工作细节的方法，能够设计或使用程序化检查错误的手段。" } } },
    "C_I_504": { name: "5.04 积极主动", levels: { "L1": { name: "应声而动", desc: "• 眼前的机会并立即采取行动，纠正眼前的问题。" }, "L2": { name: "当机立断", desc: "• 在面对危机情况时，迅速果断的采取行动去处理问题。" }, "L3": { name: "短期计划", desc: "• 在一两天的时间范围内，认识到预测三个月范围内其他人并未意识到的某个机会或问题，并采取相应的准备行动。" }, "L4": { name: "中期计划", desc: "• 通过提前一个月采取独特和额外的行动来创造机会或降低问题发生的可能性（如设立新的项目或机构，进行有针对性的巡视等）。\n• 提前三个月采取行动以避免可能出现的危机。" }, "L5": { name: "长期计划", desc: "• 能够预期到半年，或更多年以后可能发生的情况。\n• 提前半年以上采取行动以创造机会或避免问题，这些机会或问题通常不被其他人所意识到。" } } },
    "C_I_505": { name: "5.05 坚持不懈", levels: { "L1": { name: "信念坚定", desc: "• 在工作中树立了不松懈的工作信念。\n• 在受到挫折和批评时，能够抑制自己的消极想法和冲动。" }, "L2": { name: "行为坚定", desc: "• 为了达到目标，能够持续不懈地努力工作，甚至面临繁琐的、枯燥的工作任务时也能坚持。" }, "L3": { name: "克服困难", desc: "• 面对挫折时能够主动意识并正确对待自己的不足，从错误中吸取教训，坚持从头再来。" }, "L4": { name: "自我激励", desc: "• 追求目标的过程中不断地激励自己，即使很艰难也照样不停歇。\n• 能够承受较大的工作压力，采取积极行动去克服困难。" }, "L5": { name: "意志顽强", desc: "• 面对突发情况或强烈反对也毫不退缩和动摇，并团结和带领他人为实现目标一起奋斗。\n• 越挫越勇，在屡战屡败的情况下不放弃采取新的理念和方法去探索，以完成任务或达到目标。" } } },
    "C_I_506": { name: "5.06 灵活性", levels: { "L1": { name: "接受变化", desc: "• 能客观地看到情况的变化，面对新的、不同的环境或条件时，表示愿意调整。" }, "L2": { name: "愿意改变", desc: "• 面对不同的证据和信息，有改变自己看法的意愿，不固执己见。\n• 能够分析周围环境的变化情况，判断自己需要怎样调整。" }, "L3": { name: "个体变通", desc: "• 为了完成任务或达到组织目标，适当地对正常的工作程序或规章制度做临时调整以适应某种特殊情况。\n• 针对情况或他人的反应，改变自己的策略、目标或计划，以适应个人情况和客观环境。" }, "L4": { name: "组织调整", desc: "• 在自己的组织内部提倡或进行小规模或短期的调整，以应情况所需。" }, "L5": { name: "策略调整", desc: "• 在自己组织内部对工作计划、行动方案、预期目标等进行较大规模的全面及长期的调整以适应具体环境的要求。" } } },
    "C_I_507": { name: "5.07 人际交往", levels: { "L1": { name: "保持工作关系", desc: "• 与他人保持工作相关的接触，维持正式的工作关系。\n• 能够接受他人邀请参加社交活动，从而建立工作关系，但不扩大邀请或是刻意建立工作关系。" }, "L2": { name: "非正式接触", desc: "• 能敏感地把握他人的性格特点和利益需求，为今后的交往奠定基础。\n• 偶尔在工作中开始以非正式的方式与别人交流。" }, "L3": { name: "主动联络", desc: "• 积极创造与他人接触的机会，主动联络对方，利用非正式接触建立融洽关系。\n• 在交往场合，能够调动大家的交流情绪，营造使大家可以轻松交流的气氛。" }, "L4": { name: "维护关系", desc: "• 经常在工作外的集会、活动上，继续与同事或客户及其他相关人员保持友善关系。\n• 利用他人间的关系，扩大人际网络范围。" }, "L5": { name: "深厚情谊", desc: "• 与他人建立长期稳定的亲密私人友谊，相互之间可以坦率地交流，谈论敏感问题和私事。\n• 对方在对与自己有重要关系的问题上，能够主动地通风报信。\n• 能够利用私人友谊扩展业务网络。" } } },
    "C_I_508": { name: "5.08 自控能力", levels: { "L1": { name: "拒绝诱惑", desc: "• 有能力抵制可能的诱惑，不会采取不恰当和冲动的行为。" }, "L2": { name: "抑制感情", desc: "• 在感觉到强烈的情感情（例如：发怒、极其沮丧或高度压力）时，能抑制其表现出来。" }, "L3": { name: "冷静应对", desc: "• 当感觉到强烈情绪时（如发怒、极其沮丧或高度压力）时，不仅能抑制其表现出来，而且能继续平静地进行谈话或开展工作。\n• 能够长时间的抑制感情或抵抗压力，在持续的压力状况下以一贯的正常状态推进工作。" }, "L4": { name: "建设性回应", desc: "• 感觉到强烈的感情或其他压力，抑制住它们并以建设性的方法回应压力和不良情绪，冷静分析问题来源，甚至能总结避免今后出现类似情况的预防措施和应对方法。" }, "L5": { name: "安抚他人", desc: "• 在群体人员都受到强烈冲击时，不仅能够控制自己的情绪，也能鼓励别人也冷静下来，保持良好心态。" } } },
    "C_I_509": { name: "5.09 自信心", levels: { "L1": { name: "显示自信", desc: "• 明确表示不需要监督或他人主动的指导和帮助，自觉工作。\n• 以有信心、强有力的给他人留下深刻印象的方式呈现自己。" }, "L2": { name: "自主行动", desc: "• 适当的时候，能够突破他人明确要求遵守的传统和标准。\n• 必要时，即使别人反对，也能独立行动并对后果承担责任。" }, "L3": { name: "充满自信", desc: "• 对自己的能力有信心，在同级别的同事或朋友群中，认为自己是专家，能力比别人强，是事情成功的关键和重要推动者。\n• 证明自己的观点有道理，在冲突中能够清楚表达自己的立场，以行动来证明自己所表达的自信心。" }, "L4": { name: "敢于挑战", desc: "• 喜欢具有挑战性的任务，对富有挑战性的工作感到兴奋，积极要求承担新的任务和工作。\n• 当与上级管理人员、客户或其他权势人物产生意见分歧时，能直截了当但彬彬有礼地表明自己不同的看法。" }, "L5": { name: "无所畏惧", desc: "• 始终坚持自己的观点和意见，不害怕与上级主管或客户发生冲突。\n• 有意识地选择极具挑战性的任务和工作。" } } },
    "C_A_601": { name: "6.01 诚信正直", levels: { "L1": { name: "遵守制度", desc: "• 遵纪守法，遵守社会公德。\n• 遵守公司的政策原则和规章制度，不超越制度规定权限。" }, "L2": { name: "信守承诺", desc: "• 不轻易承诺，但对承诺过的事情会想办法实现。" }, "L3": { name: "实事求是", desc: "• 不说假话，真实反映客观情况，不为个人利益隐瞒事实或欺骗他人。\n• 对事情进行公平公正的评价和处理，不受个人利益影响。" }, "L4": { name: "正直廉洁", desc: "• 遇到利益诱惑时能够顶住压力，坚持原则。\n• 正直廉洁，不凭借权力谋取个人私利。" }, "L5": { name: "道德楷模", desc: "• 从自我做起，自觉维护企业在市场中树立的诚信形象，为他人充当起道德行为的楷模。\n• 对于他人违法经营、损害企业诚信形象的行为能够勇敢说服和劝导，做到自我监督和与他人的相互监督。" } } },
    "C_A_602": { name: "6.02 敬业精神", levels: { "L1": { name: "遵章守纪", desc: "• 遵守公司的各项规章制度，不迟到早退。\n• 保证饱满的工作时间，不处理与工作无关的私人事情。" }, "L2": { name: "认真做事", desc: "• 认真完成领导交办的工作任务，保证按时交付成果，符合一定的工作标准。" }, "L3": { name: "吃苦耐劳", desc: "• 工作中能够吃苦耐劳，不计较得失，以高质量标准要求自己，尽力把工作做到最好。\n• 在工作中遇到困难时不放弃，会努力克服困难完成任务。" }, "L4": { name: "全力投入", desc: "• 对工作充满激情，甘于奉献，宁愿放弃休息时间也要按时保质保量地完成任务。" }, "L5": { name: "甘于奉献", desc: "• 在工作中愿意为了公司或团队的利益付出额外的努力，放弃或牺牲个人利益。" } } },
    "C_A_603": { name: "6.03 全局观念", levels: { "L1": { name: "认清局势", desc: "• 明确了解组织中的整体战略目标和本部门目标及个人目标，企业整体利益与局部利益、个人利益之间的关系。\n• 理解组织的整体利益与局部利益、个人利益之间会不可避免地出现矛盾。" }, "L2": { name: "服从组织", desc: "• 在组织要求局部利益或个人利益做出让步时，能够进行自我调整，以服从大局。" }, "L3": { name: "遵从规则", desc: "• 遵从企业运作中的各种规则和组织的整体战略方向，从组织的整体和长远利益出发考虑本部门的工作，不会为局部小利而轻易打破规则和已经建立的平衡。" }, "L4": { name: "甘于奉献", desc: "• 在决策时通盘考虑，必要时为保证组织的整体利益不受损害，能够牺牲局部或个人利益。" }, "L5": { name: "积极维护", desc: "• 以企业发展大局为重，在组织利益受到损害时能够挺身而出，积极地维护企业利益。\n• 当局部利益和组织整体利益发生冲突时，能够顶着所在部门或团队内部的压力，做出有利于整个组织的决策。" } } },
    "C_A_604": { name: "6.04 团队合作", levels: { "L1": { name: "信息共享", desc: "• 愿意与他人合作开展工作，自愿参与和支持团队的决定。\n• 能与群体中的其他成员共同交流，分享有用的信息和资源。" }, "L2": { name: "征求意见", desc: "• 尊重他人的意见和专业知识，愿意向他人学习。\n• 在做决策时，诚恳地征求团队他人的意见、创意和经验。" }, "L3": { name: "鼓励合作", desc: "• 用正面字眼看待和谈论团队的成员，表达出对他人材智的尊重。\n• 对其他团队成员的能力和贡献给予公开赞赏和鼓励。\n• 在危机或关键时刻愿意站出来帮助其他的团队成员解决难题。" }, "L4": { name: "创造氛围", desc: "• 在团队中建立起饱满的士气，统一的行为标准和价值观以及健康的合作氛围，提升团队凝聚力。" }, "L5": { name: "解决冲突", desc: "• 不会隐藏和回避团队中的冲突，开诚布公地处理团队内部矛盾，并积极寻求有利的冲突解决方案。" } } },
    "C_A_605": { name: "6.05 责任心", levels: { "L1": { name: "明确职责", desc: "• 明确自己的工作职责和角色，认识到自己承担工作的重要性。" }, "L2": { name: "主动落实", desc: "• 以一种积极主动的姿态处理事情，对职责范围内的工作进展情况及时进行核查，对发现的问题采取必要的行动，以保证工作按要求标准完成。" }, "L3": { name: "尽职尽责", desc: "• 当工作中面临需要同时处理职责内和职责外的任务时，能主动采取应对措施，保证不因为职责以外的任务而影响职责内工作的完成情况。" }, "L4": { name: "光明磊落", desc: "• 主动公开地承担本职工作中的责任问题，不欺上瞒下，并及时主动的采取补救预防措施，防止类似的问题再次发生。" }, "L5": { name: "克己奉公", desc: "• 支持公司战略目标的实现，即使面临巨大压力或个人利益受到损失时，仍能不折不扣完成工作并承担责任。" } } },
    "C_A_606": { name: "6.06 组织承诺", levels: { "L1": { name: "遵守制度", desc: "• 了解并遵守组织的各种规章制度、礼仪规范、企业文化等。\n• 关注组织的对外形象和荣誉。" }, "L2": { name: "服从安排", desc: "• 了解并支持组织的任务和目标。\n• 服从上级安排，根据组织的需要调整自己的工作，表现出合作的态度。" }, "L3": { name: "宣扬文化", desc: "• 认同组织价值观和企业文化，经常在组织内外传播、宣导组织要求的行为规范和价值导向。" }, "L4": { name: "个人牺牲", desc: "• 组织利益与个人利益发生冲突时，将组织需求置于个人需求之上，必要的时候牺牲个人利益以保证组织的利益。" }, "L5": { name: "要求他人", desc: "• 即使会导致不受他人欢迎，为了组织的利益，也要力排众议。\n• 要求他人也作出牺牲以符合组织的需求。" } } },
};

const modelData = {
    "S_T_Dev": {
        "P_10": ["C_P_303 L1", "C_T_402 L1", "C_T_405 L1", "C_A_604 L1"],
        "P_21": ["C_P_303 L2", "C_T_402 L2", "C_T_405 L2", "C_A_604 L2"],
        "P_22": ["C_P_303 L2", "C_T_402 L3", "C_T_405 L3", "C_A_604 L2"],
        "P_23": ["C_P_303 L3", "C_T_402 L3", "C_T_405 L3", "C_A_604 L3"],
        "P_31": ["C_P_303 L3", "C_T_402 L4", "C_T_405 L4", "C_A_604 L3"],
        "P_32": ["C_P_303 L4", "C_T_402 L4", "C_T_405 L4", "C_A_604 L4"],
        "P_33": ["C_P_303 L4", "C_T_402 L5", "C_T_405 L5", "C_A_604 L4"],
        "P_40": ["C_P_303 L5", "C_T_402 L5", "C_T_405 L5", "C_A_604 L5"]
    },
    "S_T_Sec": {
        "P_10": ["C_P_303 L1", "C_A_605 L2", "C_T_402 L1", "C_I_503 L2"],
        "P_21": ["C_P_303 L2", "C_A_605 L3", "C_T_402 L2", "C_I_503 L3"],
        "P_22": ["C_P_303 L2", "C_A_605 L3", "C_T_402 L3", "C_I_503 L3"],
        "P_23": ["C_P_303 L3", "C_A_605 L4", "C_T_402 L3", "C_I_503 L4"],
        "P_31": ["C_P_303 L3", "C_A_605 L4", "C_T_402 L4", "C_I_503 L4"],
        "P_32": ["C_P_303 L4", "C_A_605 L5", "C_T_402 L4", "C_I_503 L5"],
        "P_33": ["C_P_303 L4", "C_A_605 L5", "C_T_402 L5", "C_I_503 L5"],
        "P_40": ["C_P_303 L5", "C_A_605 L5", "C_T_402 L5", "C_I_503 L5"]
    },
    "S_T_TA": {
        "P_10": ["C_P_303 L1", "C_T_401 L1", "C_A_604 L2", "C_T_402 L1"],
        "P_21": ["C_P_303 L2", "C_T_401 L2", "C_A_604 L2", "C_T_402 L2"],
        "P_22": ["C_P_303 L2", "C_T_401 L2", "C_A_604 L3", "C_T_402 L3"],
        "P_23": ["C_P_303 L3", "C_T_401 L3", "C_A_604 L3", "C_T_402 L3"],
        "P_31": ["C_P_303 L3", "C_T_401 L3", "C_A_604 L4", "C_T_402 L4"],
        "P_32": ["C_P_303 L4", "C_T_401 L4", "C_A_604 L4", "C_T_402 L4"],
        "P_33": ["C_P_303 L4", "C_T_401 L4", "C_A_604 L5", "C_T_402 L5"],
        "P_40": ["C_P_303 L5", "C_T_401 L5", "C_A_604 L5", "C_T_402 L5"]
    },
    "S_T_Ops": {
        "P_10": ["C_A_605 L2", "C_P_303 L1", "C_I_504 L2", "C_T_402 L1"],
        "P_21": ["C_A_605 L3", "C_P_303 L2", "C_I_504 L2", "C_T_402 L2"],
        "P_22": ["C_A_605 L3", "C_P_303 L2", "C_I_504 L3", "C_T_402 L3"],
        "P_23": ["C_A_605 L4", "C_P_303 L3", "C_I_504 L3", "C_T_402 L3"],
        "P_31": ["C_A_605 L4", "C_P_303 L3", "C_I_504 L4", "C_T_402 L4"],
        "P_32": ["C_A_605 L5", "C_P_303 L4", "C_I_504 L4", "C_T_402 L4"],
        "P_33": ["C_A_605 L5", "C_P_303 L4", "C_I_504 L5", "C_T_402 L5"],
        "P_40": ["C_A_605 L5", "C_P_303 L5", "C_I_504 L5", "C_T_402 L5"]
    },
    "S_T_QA": {
        "P_10": ["C_I_503 L2", "C_P_302 L1", "C_A_605 L2", "C_I_502 L1"],
        "P_21": ["C_I_503 L3", "C_P_302 L2", "C_A_605 L3", "C_I_502 L2"],
        "P_22": ["C_I_503 L3", "C_P_302 L2", "C_A_605 L3", "C_I_502 L2"],
        "P_23": ["C_I_503 L4", "C_P_302 L3", "C_A_605 L4", "C_I_502 L3"],
        "P_31": ["C_I_503 L4", "C_P_302 L3", "C_A_605 L4", "C_I_502 L3"],
        "P_32": ["C_I_503 L5", "C_P_302 L4", "C_A_605 L5", "C_I_502 L4"],
        "P_33": ["C_I_503 L5", "C_P_302 L4", "C_A_605 L5", "C_I_502 L4"],
        "P_40": ["C_I_503 L5", "C_P_302 L5", "C_A_605 L5", "C_I_502 L5"]
    },
    "S_A_Design": { // Combined Design and UDUX
        "P_10": ["C_P_302 L1", "C_T_401 L1", "C_P_303 L1", "C_I_502 L2"],
        "P_21": ["C_P_302 L2", "C_T_401 L2", "C_P_303 L2", "C_I_502 L2"],
        "P_22": ["C_P_302 L3", "C_T_401 L2", "C_P_303 L2", "C_I_502 L3"],
        "P_23": ["C_P_302 L3", "C_T_401 L3", "C_P_303 L3", "C_I_502 L3"],
        "P_31": ["C_P_302 L4", "C_T_401 L3", "C_P_303 L3", "C_I_502 L4"],
        "P_32": ["C_P_302 L4", "C_T_401 L4", "C_P_303 L4", "C_I_502 L4"],
        "P_33": ["C_P_302 L5", "C_T_401 L4", "C_P_303 L4", "C_I_502 L5"],
        "P_40": ["C_P_302 L5", "C_T_401 L5", "C_P_303 L5", "C_I_502 L5"]
    },
    "S_A_UDUX": { // Same as Design
        "P_10": ["C_P_302 L1", "C_T_401 L1", "C_P_303 L1", "C_I_502 L2"],
        "P_21": ["C_P_302 L2", "C_T_401 L2", "C_P_303 L2", "C_I_502 L2"],
        "P_22": ["C_P_302 L3", "C_T_401 L2", "C_P_303 L2", "C_I_502 L3"],
        "P_23": ["C_P_302 L3", "C_T_401 L3", "C_P_303 L3", "C_I_502 L3"],
        "P_31": ["C_P_302 L4", "C_T_401 L3", "C_P_303 L3", "C_I_502 L4"],
        "P_32": ["C_P_302 L4", "C_T_401 L4", "C_P_303 L4", "C_I_502 L4"],
        "P_33": ["C_P_302 L5", "C_T_401 L4", "C_P_303 L4", "C_I_502 L5"],
        "P_40": ["C_P_302 L5", "C_T_401 L5", "C_P_303 L5", "C_I_502 L5"]
    },
    "S_A_GameArt": {
        "P_10": ["C_P_303 L1", "C_T_401 L1", "C_A_604 L1", "C_I_503 L2"],
        "P_21": ["C_P_303 L2", "C_T_401 L2", "C_A_604 L2", "C_I_503 L3"],
        "P_22": ["C_P_303 L2", "C_T_401 L2", "C_A_604 L2", "C_I_503 L3"],
        "P_23": ["C_P_303 L3", "C_T_401 L3", "C_A_604 L3", "C_I_503 L4"],
        "P_31": ["C_P_303 L3", "C_T_401 L3", "C_A_604 L3", "C_I_503 L4"],
        "P_32": ["C_P_303 L4", "C_T_401 L4", "C_A_604 L4", "C_I_503 L5"],
        "P_33": ["C_P_303 L4", "C_T_401 L4", "C_A_604 L4", "C_I_503 L5"],
        "P_40": ["C_P_303 L5", "C_T_401 L5", "C_A_604 L5", "C_I_503 L5"]
    },
    "S_A_Video": { // Combined Video and Audio
        "P_10": ["C_P_303 L1", "C_T_401 L1", "C_I_503 L2", "C_A_604 L1"],
        "P_21": ["C_P_303 L2", "C_T_401 L2", "C_I_503 L3", "C_A_604 L2"],
        "P_22": ["C_P_303 L2", "C_T_401 L2", "C_I_503 L3", "C_A_604 L2"],
        "P_23": ["C_P_303 L3", "C_T_401 L3", "C_I_503 L4", "C_A_604 L3"],
        "P_31": ["C_P_303 L3", "C_T_401 L3", "C_I_503 L4", "C_A_604 L3"],
        "P_32": ["C_P_303 L4", "C_T_401 L4", "C_I_503 L5", "C_A_604 L4"],
        "P_33": ["C_P_303 L4", "C_T_401 L4", "C_I_503 L5", "C_A_604 L4"],
        "P_40": ["C_P_303 L5", "C_T_401 L5", "C_I_503 L5", "C_A_604 L5"]
    },
    "S_A_Audio": { // Same as Video
        "P_10": ["C_P_303 L1", "C_T_401 L1", "C_I_503 L2", "C_A_604 L1"],
        "P_21": ["C_P_303 L2", "C_T_401 L2", "C_I_503 L3", "C_A_604 L2"],
        "P_22": ["C_P_303 L2", "C_T_401 L2", "C_I_503 L3", "C_A_604 L2"],
        "P_23": ["C_P_303 L3", "C_T_401 L3", "C_I_503 L4", "C_A_604 L3"],
        "P_31": ["C_P_303 L3", "C_T_401 L3", "C_I_503 L4", "C_A_604 L3"],
        "P_32": ["C_P_303 L4", "C_T_401 L4", "C_I_503 L5", "C_A_604 L4"],
        "P_33": ["C_P_303 L4", "C_T_401 L4", "C_I_503 L5", "C_A_604 L4"],
        "P_40": ["C_P_303 L5", "C_T_401 L5", "C_I_503 L5", "C_A_604 L5"]
    },
    "S_P_ProdPlan": { // Combined Product and Game Plan
        "P_10": ["C_P_302 L1", "C_T_401 L1", "C_T_403 L1", "C_M_204 L1"],
        "P_21": ["C_P_302 L2", "C_T_401 L2", "C_T_403 L2", "C_M_204 L1"],
        "P_22": ["C_P_302 L3", "C_T_401 L2", "C_T_403 L3", "C_M_204 L2"],
        "P_23": ["C_P_302 L3", "C_T_401 L3", "C_T_403 L3", "C_M_204 L2"],
        "P_31": ["C_P_302 L4", "C_T_401 L3", "C_T_403 L4", "C_M_204 L3"],
        "P_32": ["C_P_302 L4", "C_T_401 L4", "C_T_403 L4", "C_M_204 L4"],
        "P_33": ["C_P_302 L5", "C_T_401 L4", "C_T_403 L5", "C_M_204 L4"],
        "P_40": ["C_P_302 L5", "C_T_401 L5", "C_T_403 L5", "C_M_204 L5"]
    },
    "S_P_GamePlan": { // Same as Product Plan
        "P_10": ["C_P_302 L1", "C_T_401 L1", "C_T_403 L1", "C_M_204 L1"],
        "P_21": ["C_P_302 L2", "C_T_401 L2", "C_T_403 L2", "C_M_204 L1"],
        "P_22": ["C_P_302 L3", "C_T_401 L2", "C_T_403 L3", "C_M_204 L2"],
        "P_23": ["C_P_302 L3", "C_T_401 L3", "C_T_403 L3", "C_M_204 L2"],
        "P_31": ["C_P_302 L4", "C_T_401 L3", "C_T_403 L4", "C_M_204 L3"],
        "P_32": ["C_P_302 L4", "C_T_401 L4", "C_T_403 L4", "C_M_204 L4"],
        "P_33": ["C_P_302 L5", "C_T_401 L4", "C_T_403 L5", "C_M_204 L4"],
        "P_40": ["C_P_302 L5", "C_T_401 L5", "C_T_403 L5", "C_M_204 L5"]
    },
    "S_O_WebOps": { // Combined Web and Game Ops
        "P_10": ["C_P_302 L1", "C_T_402 L1", "C_M_201 L1", "C_T_401 L1"],
        "P_21": ["C_P_302 L2", "C_T_402 L2", "C_M_201 L2", "C_T_401 L2"],
        "P_22": ["C_P_302 L3", "C_T_402 L3", "C_M_201 L2", "C_T_401 L2"],
        "P_23": ["C_P_302 L3", "C_T_402 L3", "C_M_201 L3", "C_T_401 L3"],
        "P_31": ["C_P_302 L4", "C_T_402 L4", "C_M_201 L3", "C_T_401 L3"],
        "P_32": ["C_P_302 L4", "C_T_402 L4", "C_M_201 L4", "C_T_401 L4"],
        "P_33": ["C_P_302 L5", "C_T_402 L5", "C_M_201 L4", "C_T_401 L4"],
        "P_40": ["C_P_302 L5", "C_T_402 L5", "C_M_201 L5", "C_T_401 L5"]
    },
    "S_O_GameOps": { // Same as Web Ops
        "P_10": ["C_P_302 L1", "C_T_402 L1", "C_M_201 L1", "C_T_401 L1"],
        "P_21": ["C_P_302 L2", "C_T_402 L2", "C_M_201 L2", "C_T_401 L2"],
        "P_22": ["C_P_302 L3", "C_T_402 L3", "C_M_201 L2", "C_T_401 L2"],
        "P_23": ["C_P_302 L3", "C_T_402 L3", "C_M_201 L3", "C_T_401 L3"],
        "P_31": ["C_P_302 L4", "C_T_402 L4", "C_M_201 L3", "C_T_401 L3"],
        "P_32": ["C_P_302 L4", "C_T_402 L4", "C_M_201 L4", "C_T_401 L4"],
        "P_33": ["C_P_302 L5", "C_T_402 L5", "C_M_201 L4", "C_T_401 L4"],
        "P_40": ["C_P_302 L5", "C_T_402 L5", "C_M_201 L5", "C_T_401 L5"]
    },
    "S_O_ContentRisk": {
        "P_10": ["C_A_605 L2", "C_A_601 L2", "C_I_503 L2", "C_M_202 L1"],
        "P_21": ["C_A_605 L3", "C_A_601 L3", "C_I_503 L3", "C_M_202 L2"],
        "P_22": ["C_A_605 L3", "C_A_601 L3", "C_I_503 L3", "C_M_202 L2"],
        "P_23": ["C_A_605 L4", "C_A_601 L4", "C_I_503 L4", "C_M_202 L3"],
        "P_31": ["C_A_605 L4", "C_A_601 L4", "C_I_503 L4", "C_M_202 L3"],
        "P_32": ["C_A_605 L5", "C_A_601 L5", "C_I_503 L5", "C_M_202 L4"],
        "P_33": ["C_A_605 L5", "C_A_601 L5", "C_I_503 L5", "C_M_202 L4"],
        "P_40": ["C_A_605 L5", "C_A_601 L5", "C_I_503 L5", "C_M_202 L5"]
    },
    "S_S_All": { // Simplified for all market/biz sequences
        "P_10": ["C_I_501 L1", "C_M_204 L1", "C_I_507 L1", "C_P_302 L1"],
        "P_21": ["C_I_501 L2", "C_M_204 L2", "C_I_507 L2", "C_P_302 L2"],
        "P_22": ["C_I_501 L3", "C_M_204 L2", "C_I_507 L3", "C_P_302 L2"],
        "P_23": ["C_I_501 L3", "C_M_204 L3", "C_I_507 L3", "C_P_302 L3"],
        "P_31": ["C_I_501 L4", "C_M_204 L3", "C_I_507 L4", "C_P_302 L3"],
        "P_32": ["C_I_501 L4", "C_M_204 L4", "C_I_507 L4", "C_P_302 L4"],
        "P_33": ["C_I_501 L5", "C_M_204 L4", "C_I_507 L5", "C_P_302 L4"],
        "P_40": ["C_I_501 L5", "C_M_204 L5", "C_I_507 L5", "C_P_302 L5"]
    },
    "S_F_All": { // Simplified for all function sequences except HR
        "P_10": ["C_A_601 L2", "C_A_605 L2", "C_P_303 L1", "C_P_302 L1"],
        "P_21": ["C_A_601 L3", "C_A_605 L3", "C_P_303 L2", "C_P_302 L2"],
        "P_22": ["C_A_601 L3", "C_A_605 L3", "C_P_303 L2", "C_P_302 L2"],
        "P_23": ["C_A_601 L4", "C_A_605 L4", "C_P_303 L3", "C_P_302 L3"],
        "P_31": ["C_A_601 L4", "C_A_605 L4", "C_P_303 L3", "C_P_302 L3"],
        "P_32": ["C_A_601 L5", "C_A_605 L5", "C_P_303 L4", "C_P_302 L4"],
        "P_33": ["C_A_601 L5", "C_A_605 L5", "C_P_303 L4", "C_P_302 L4"],
        "P_40": ["C_A_601 L5", "C_A_605 L5", "C_P_303 L5", "C_P_302 L5"]
    },
    "S_F_HR": {
        "P_10": ["C_I_502 L2", "C_P_302 L2", "C_A_601 L2", "C_M_205 L1"],
        "P_21": ["C_I_502 L3", "C_P_302 L3", "C_A_601 L3", "C_M_205 L2"],
        "P_22": ["C_I_502 L3", "C_P_302 L3", "C_A_601 L3", "C_M_205 L2"],
        "P_23": ["C_I_502 L4", "C_P_302 L4", "C_A_601 L4", "C_M_205 L3"],
        "P_31": ["C_I_502 L4", "C_P_302 L4", "C_A_601 L4", "C_M_205 L3"],
        "P_32": ["C_I_502 L5", "C_P_302 L5", "C_A_601 L5", "C_M_205 L4"],
        "P_33": ["C_I_502 L5", "C_P_302 L5", "C_A_601 L5", "C_M_205 L4"],
        "P_40": ["C_I_502 L5", "C_P_302 L5", "C_A_601 L5", "C_M_205 L5"]
    },
    "S_PM_All": { // Simplified for all PM sequences
        "P_10": ["C_M_201 L1", "C_A_605 L2", "C_M_205 L1", "C_I_502 L2"],
        "P_21": ["C_M_201 L2", "C_A_605 L3", "C_M_205 L2", "C_I_502 L3"],
        "P_22": ["C_M_201 L2", "C_A_605 L3", "C_M_205 L2", "C_I_502 L3"],
        "P_23": ["C_M_201 L3", "C_A_605 L4", "C_M_205 L3", "C_I_502 L4"],
        "P_31": ["C_M_201 L3", "C_A_605 L4", "C_M_205 L3", "C_I_502 L4"],
        "P_32": ["C_M_201 L4", "C_A_605 L5", "C_M_205 L4", "C_I_502 L5"],
        "P_33": ["C_M_201 L4", "C_A_605 L5", "C_M_205 L4", "C_I_502 L5"],
        "P_40": ["C_M_201 L5", "C_A_605 L5", "C_M_205 L5", "C_I_502 L5"]
    }
};

// --- APPLICATION LOGIC ---

document.addEventListener('DOMContentLoaded', () => {
    // DOM Elements
    const primarySelect = document.getElementById('primarySequence');
    const secondarySelect = document.getElementById('secondarySequence');
    const levelSelect = document.getElementById('jobLevel');
    const resumeText = document.getElementById('resumeText');
    const resultsContainer = document.getElementById('results');
    const placeholder = document.getElementById('placeholder');
    const addCompetencyBtn = document.getElementById('addCompetencyBtn');
    const addCompetencyBtnContainer = document.getElementById('addCompetencyBtnContainer');
    const modal = document.getElementById('addCompetencyModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modalSearch = document.getElementById('modalSearch');
    const modalList = document.getElementById('modalCompetencyList');
    // New Analysis Elements
    const analysisSection = document.getElementById('analysisSection');
    const tabText = document.getElementById('tab-text');
    const tabAudio = document.getElementById('tab-audio');
    const contentText = document.getElementById('content-text');
    const contentAudio = document.getElementById('content-audio');
    const interviewTranscript = document.getElementById('interviewTranscript');
    const startAnalysisBtn = document.getElementById('startAnalysisBtn');
    const analysisResultContainer = document.getElementById('analysisResultContainer');
    
    // OAuth Elements
    const loginModal = document.getElementById('loginModal');
    const closeLoginModalBtn = document.getElementById('closeLoginModalBtn');
    const loginBtn = document.getElementById('loginBtn');
    const userInfoHeader = document.getElementById('userInfoHeader');
    const userName = document.getElementById('userName');
    const userEmail = document.getElementById('userEmail');
    const logoutBtn = document.getElementById('logoutBtn');
    
    // OAuth State
    let currentSessionId = null;
    let currentUser = null;

    
    // --- Initialization ---

    function init() {
        populatePrimarySequences();
        populateLevels();
        populateModalList();
        addEventListeners();
        initOAuth();
    }

    function populatePrimarySequences() {
        Object.keys(sequencesData).forEach(primary => {
            const option = document.createElement('option');
            option.value = primary;
            option.textContent = primary;
            primarySelect.appendChild(option);
        });
    }

    function populateLevels() {
        levelsData.forEach(level => {
            const option = document.createElement('option');
            option.value = level.code;
            option.textContent = level.name;
            levelSelect.appendChild(option);
        });
    }

    function populateModalList() {
        modalList.innerHTML = '';
        Object.entries(competenciesData).forEach(([code, data]) => {
            const item = document.createElement('div');
            item.className = 'p-3 hover:bg-gray-100 rounded-lg cursor-pointer';
            item.textContent = data.name;
            item.dataset.code = code;
            item.addEventListener('click', () => {
                addCompetencyCard(code, 'L1');
                modal.classList.add('hidden');
            });
            modalList.appendChild(item);
        });
    }

    // --- Event Listeners ---

    function addEventListeners() {
        primarySelect.addEventListener('change', handlePrimaryChange);
        secondarySelect.addEventListener('change', handleSecondaryChange);
        levelSelect.addEventListener('change', updateResults);
        
        addCompetencyBtn.addEventListener('click', () => modal.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
        modalSearch.addEventListener('input', handleModalSearch);

        // New Listeners for Analysis section
        tabText.addEventListener('click', () => switchTab('text'));
        tabAudio.addEventListener('click', () => switchTab('audio'));
        startAnalysisBtn.addEventListener('click', handleStartAnalysis);
        
        // OAuth Listeners
        loginBtn.addEventListener('click', handleLogin);
        closeLoginModalBtn.addEventListener('click', () => loginModal.classList.add('hidden'));
        logoutBtn.addEventListener('click', handleLogout);
        loginModal.addEventListener('click', (e) => {
            if (e.target === loginModal) {
                loginModal.classList.add('hidden');
            }
        });
    }

    // --- Handlers ---
    
    function switchTab(tabName) {
        if (tabName === 'text') {
            tabText.classList.add('active');
            tabAudio.classList.remove('active');
            contentText.classList.add('active');
            contentAudio.classList.remove('active');
        } else {
            tabAudio.classList.add('active');
            tabText.classList.remove('active');
            contentAudio.classList.add('active');
            contentText.classList.remove('active');
        }
    }

    function handlePrimaryChange() {
        const selectedPrimary = primarySelect.value;
        secondarySelect.innerHTML = '<option value="">请选择</option>';
        secondarySelect.disabled = true;
        levelSelect.disabled = true;
        addCompetencyBtnContainer.classList.add('hidden');
        analysisSection.classList.add('hidden');
        
        if (selectedPrimary && sequencesData[selectedPrimary]) {
            sequencesData[selectedPrimary].forEach(secondary => {
                const option = document.createElement('option');
                option.value = secondary.code;
                option.textContent = secondary.name;
                secondarySelect.appendChild(option);
            });
            secondarySelect.disabled = false;
        }
        clearResults();
    }
    
    function handleSecondaryChange() {
        levelSelect.disabled = secondarySelect.value === '';
        clearResults();
    }
    
    function handleModalSearch(e) {
        const searchTerm = e.target.value.toLowerCase();
        const items = modalList.getElementsByTagName('div');
        Array.from(items).forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    // --- Core Logic ---

    function updateResults() {
        // 检查登录状态
        if (!currentUser) {
            showLoginModal();
            return;
        }
        
        const secondaryCode = secondarySelect.value;
        const levelCode = levelSelect.value;

        if (!secondaryCode || !levelCode) {
            clearResults();
            return;
        }
        
        addCompetencyBtnContainer.classList.remove('hidden');
        analysisSection.classList.remove('hidden');
        resultsContainer.innerHTML = '';
        
        let modelKey = getModelKey(secondaryCode);
        const competencyLevels = modelData[modelKey] ? modelData[modelKey][levelCode] : [];

        if (competencyLevels && competencyLevels.length > 0) {
            competencyLevels.forEach(cl => {
                const [competencyCode, level] = cl.split(' ');
                addCompetencyCard(competencyCode, level);
            });
        } else {
            showPlaceholder('未找到匹配的能力模型。', '您可以手动添加能力项。');
        }
    }
    
    function getModelKey(secondaryCode) {
        // This function handles simplified keys like S_S_All
        if (secondaryCode.startsWith('S_S_')) return 'S_S_All';
        if (secondaryCode.startsWith('S_F_') && secondaryCode !== 'S_F_HR') return 'S_F_All';
        if (secondaryCode.startsWith('S_PM_')) return 'S_PM_All';
        return secondaryCode;
    }

    function addCompetencyCard(competencyCode, requiredLevel) {
        const placeholderDiv = document.getElementById('placeholder');
        if (placeholderDiv) {
            placeholderDiv.remove();
        }
        const card = createCompetencyCard(competencyCode, requiredLevel);
        resultsContainer.appendChild(card);
    }
    
    function createCompetencyCard(competencyCode, requiredLevel) {
        const competency = competenciesData[competencyCode];
        if (!competency) return document.createElement('div');

        const card = document.createElement('div');
        card.className = 'competency-card bg-white p-6 rounded-xl shadow-lg border border-gray-200 flex flex-col h-full';
        card.dataset.competencyCode = competencyCode;

        // Card Header
        const header = document.createElement('div');
        header.className = 'flex justify-between items-start mb-4';
        
        const titleGroup = document.createElement('div');
        const title = document.createElement('h2');
        title.className = 'text-lg font-bold text-gray-800';
        title.textContent = competency.name;
        titleGroup.appendChild(title);
        
        const levelSelector = document.createElement('select');
        levelSelector.className = 'w-full p-2 border border-gray-300 rounded-lg text-sm mt-2';
        Object.keys(competency.levels).forEach((levelKey, index) => {
            const option = document.createElement('option');
            option.value = levelKey;
            option.textContent = `等级 ${index + 1}: ${competency.levels[levelKey].name}`;
            if (levelKey === requiredLevel) {
                option.selected = true;
            }
            levelSelector.appendChild(option);
        });
        titleGroup.appendChild(levelSelector);

        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = `
            <svg class="w-6 h-6 text-gray-400 hover:text-red-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>`;
        deleteBtn.onclick = () => card.remove();
        
        header.appendChild(titleGroup);
        header.appendChild(deleteBtn);

        // Behaviors container
        const behaviorsContainer = document.createElement('div');
        behaviorsContainer.className = 'space-y-4 flex-1';

        // --- Interview Questions Section ---
        const questionsSection = document.createElement('div');
        questionsSection.className = 'mt-6 border-t pt-4 mt-auto';

        const generateBtn = document.createElement('button');
        generateBtn.className = 'bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition text-sm';
        generateBtn.textContent = '生成面试问题';

        const questionsContainer = document.createElement('div');
        questionsContainer.className = 'mt-4 text-sm hidden';

        questionsSection.appendChild(generateBtn);
        questionsSection.appendChild(questionsContainer);
        
        generateBtn.addEventListener('click', () => {
            if (questionsContainer.classList.contains('hidden')) {
                const currentResumeText = document.getElementById('resumeText').value;
                handleGenerateQuestions(competencyCode, levelSelector.value, currentResumeText, questionsContainer, generateBtn);
            } else {
                questionsContainer.classList.add('hidden');
                generateBtn.textContent = '生成面试问题';
            }
        });


        card.appendChild(header);
        card.appendChild(behaviorsContainer);
        card.appendChild(questionsSection);
        
        function updateBehaviors(level) {
            behaviorsContainer.innerHTML = '';
            const requiredLevelNum = parseInt(level.replace('L', ''));
            
            for (let i = 1; i <= requiredLevelNum; i++) {
                const currentLevelKey = `L${i}`;
                const levelData = competency.levels[currentLevelKey];
                if (levelData) {
                    const behaviorDiv = document.createElement('div');
                    behaviorDiv.className = 'p-3 rounded-lg';
                    
                    const isTargetLevel = i === requiredLevelNum;
                    const classes = isTargetLevel ? 'bg-blue-50 border-l-4 border-blue-500' : 'bg-gray-50 border-l-4 border-gray-300';
                    behaviorDiv.classList.add(...classes.split(' '));

                    const levelTitle = document.createElement('h4');
                    levelTitle.className = 'font-semibold text-md';
                    levelTitle.textContent = `等级 ${i}: ${levelData.name}`;
                    levelTitle.classList.add(isTargetLevel ? 'text-blue-800' : 'text-gray-700');

                    const levelDesc = document.createElement('p');
                    levelDesc.className = 'text-sm text-gray-600 mt-1 whitespace-pre-line';
                    levelDesc.textContent = levelData.desc;

                    behaviorDiv.appendChild(levelTitle);
                    behaviorDiv.appendChild(levelDesc);
                    behaviorsContainer.appendChild(behaviorDiv);
                }
            }
            questionsContainer.classList.add('hidden');
            generateBtn.textContent = '生成面试问题';
            questionsContainer.innerHTML = '';
        }
        
        levelSelector.addEventListener('change', (e) => updateBehaviors(e.target.value));
        updateBehaviors(requiredLevel);

        return card;
    }
    
    // --- 通义千问 API Call Logic ---
    async function handleGenerateQuestions(competencyCode, requiredLevel, resumeContent, container, button) {
        container.classList.remove('hidden');
        button.textContent = '隐藏面试问题';

        if (container.innerHTML !== '' && !container.innerHTML.includes('spinner')) {
            return;
        }

        container.innerHTML = `<div class="flex items-center text-gray-500"><div class="spinner"></div>正在生成问题...</div>`;
        
        const competency = competenciesData[competencyCode];
        const levelInfo = competency.levels[requiredLevel];
        const behaviorDescription = levelInfo.desc;

        let prompt;
        if (resumeContent && resumeContent.trim() !== '') {
            prompt = `
            你是一名专业的HR面试专家，精通行为面试法（BEI）。
            请为以下能力项，并结合候选人的简历正文，生成3个高质量且高度个性化的行为面试问题。

            能力项名称: "${competency.name}"
            考察的行为等级: "${requiredLevel}: ${levelInfo.name}"
            具体的行为描述: 
            "${behaviorDescription}"

            --- 候选人简历正文 ---
            ${resumeContent}
            --- END ---

            要求:
            1.  问题必须引导候选人分享一个完整的过往经历，包括当时的情境、面临的任务、采取的行动和最终的结果。
            2.  问题必须将候选人简历中的具体项目、职责或成就（例如：“简历中提到您负责了XX项目...”）与我们正在考察的行为描述直接关联起来。
            3.  如果简历内容与该能力项没有直接关联，请生成通用的行为面试问题，但可以尝试提出探索性的问题。
            4.  请直接返回3个问题，以有序列表的格式（例如：1. ... 2. ... 3. ...），语言为中文。
            `;
        } else {
            prompt = `
            你是一名专业的HR面试专家，精通行为面试法（BEI）。
            请为以下能力项生成3个高质量的行为面试问题。

            能力项名称: "${competency.name}"
            考察的行为等级: "${requiredLevel}: ${levelInfo.name}"
            具体的行为描述: 
            "${behaviorDescription}"

            要求:
            1.  问题必须引导候选人分享一个完整的过往经历，包括当时的情境、面临的任务、采取的行动和最终的结果。
            2.  问题开头应使用引导性话语，例如“请分享一个例子…”, “请讲一件你…的事”, “请描述一个当时…的情境”。
            3.  问题需要精准地考察上述“具体的行为描述”中提到的关键行为。
            4.  请直接返回3个问题，以有序列表的格式（例如：1. ... 2. ... 3. ...），语言为中文。
            `;
        }


        try {
            const resultText = await callQwenAPIWithRetry(prompt);
            
            // 解析问题文本，提取问题内容
            const questions = resultText.split(/\d+\./).filter(q => q.trim()).map(q => q.trim());
            
            // 生成美观的问题卡片
            const questionsHTML = questions.map((question, index) => `
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4 mb-4 hover:shadow-lg transition-shadow">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 leading-relaxed">${question}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // 添加STAR说明和底部信息
            container.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600 text-xl">✅</span>
                            <span class="text-green-800 font-medium">通义千问AI已生成${questions.length}个基于BEI和STAR原则的面试问题</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        ${questionsHTML}
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800 mb-2">STAR追问技巧</h4>
                            <p class="text-yellow-700 text-sm">S情境 → T任务 → A行动 → R结果</p>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800 mb-2">评估要点</h4>
                            <p class="text-yellow-700 text-sm">关注具体行为、思考逻辑和结果导向</p>
                        </div>
                    </div>
                    
                    <div class="text-center text-gray-500 text-sm mt-4">
                        <span class="inline-flex items-center">
                            <span class="mr-1">⚡</span>
                            由通义千问AI驱动
                        </span>
                    </div>
                </div>
            `;
        } catch (error) {
            console.error("Error calling Qwen API:", error);
            container.innerHTML = `<p class="text-red-500">问题生成失败，请稍后重试。</p>`;
        }
    }
    
    async function callQwenAPIWithRetry(prompt, retries = 3, delay = 1000) {
        for (let i = 0; i < retries; i++) {
            try {
                // 使用本地代理服务器避免CORS问题
                const apiUrl = "/api/qwen";
                
                const payload = {
                    model: "qwen-turbo",
                    input: {
                        messages: [
                            {
                                role: "user",
                                content: prompt
                            }
                        ]
                    }
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.output && result.output.choices && result.output.choices.length > 0 &&
                    result.output.choices[0].message && result.output.choices[0].message.content) {
                    return result.output.choices[0].message.content;
                } else {
                    throw new Error("Invalid API response structure");
                }
            } catch (error) {
                console.warn(`Qwen API call attempt ${i + 1} failed. Retrying in ${delay}ms...`);
                if (i === retries - 1) throw error; // Throw error on last attempt
                await new Promise(res => setTimeout(res, delay));
                delay *= 2; // Exponential backoff
            }
        }
    }

    function clearResults() {
        resultsContainer.innerHTML = '';
        const placeholderDiv = document.getElementById('placeholder');
        if (placeholderDiv) {
             resultsContainer.appendChild(placeholderDiv);
        }
        addCompetencyBtnContainer.classList.add('hidden');
        analysisSection.classList.add('hidden');
    }

    function showPlaceholder(title, message) {
        resultsContainer.innerHTML = '';
        const p = document.getElementById('placeholder').cloneNode(true);
        p.querySelector('h3').textContent = title;
        p.querySelector('p').textContent = message;
        resultsContainer.appendChild(p);
    }
    
    // --- OAuth Functions ---
    
    function initOAuth() {
        // 检查URL参数中是否有sessionId（OAuth回调）
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('sessionId');
        const error = urlParams.get('error');
        
        if (error) {
            console.error('OAuth error:', error);
            showError(`登录失败: ${error}`);
            return;
        }
        
        if (sessionId) {
            // OAuth回调成功，获取用户信息
            currentSessionId = sessionId;
            fetchUserInfo(sessionId);
            // 清除URL参数
            window.history.replaceState({}, document.title, window.location.pathname);
        } else {
            // 检查是否有现有的会话
            const savedSessionId = localStorage.getItem('sessionId');
            if (savedSessionId) {
                currentSessionId = savedSessionId;
                checkAuthStatus(savedSessionId);
            } else {
                // 没有会话，显示登录模态框
                showLoginModal();
            }
        }
    }
    
    function showLoginModal() {
        loginModal.classList.remove('hidden');
    }
    
    function hideLoginModal() {
        loginModal.classList.add('hidden');
    }
    
    function handleLogin() {
        // 重定向到OAuth登录
        const loginUrl = `/auth/login?sessionId=${generateState()}`;
        window.location.href = loginUrl;
    }
    
    function handleLogout() {
        // 清除本地存储
        localStorage.removeItem('sessionId');
        localStorage.removeItem('userInfo');
        
        // 调用登出API
        if (currentSessionId) {
            fetch('/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ sessionId: currentSessionId })
            }).catch(console.error);
        }
        
        // 重置状态
        currentSessionId = null;
        currentUser = null;
        
        // 隐藏用户信息
        userInfoHeader.classList.add('hidden');
        
        // 显示登录模态框
        showLoginModal();
    }
    
    async function checkAuthStatus(sessionId) {
        try {
            const response = await fetch(`/api/auth/status?sessionId=${sessionId}`);
            const data = await response.json();
            
            if (data.isLoggedIn) {
                currentUser = data.user;
                updateUserInfo(data.user);
                userInfoHeader.classList.remove('hidden');
                hideLoginModal();
            } else {
                // 会话无效，清除本地存储
                localStorage.removeItem('sessionId');
                localStorage.removeItem('userInfo');
                showLoginModal();
            }
        } catch (error) {
            console.error('Auth status check failed:', error);
            showLoginModal();
        }
    }
    
    async function fetchUserInfo(sessionId) {
        try {
            const response = await fetch(`/api/user?sessionId=${sessionId}`);
            const data = await response.json();
            
            if (response.ok) {
                currentUser = data.user;
                currentSessionId = data.sessionId;
                
                // 保存到本地存储
                localStorage.setItem('sessionId', data.sessionId);
                localStorage.setItem('userInfo', JSON.stringify(data.user));
                
                // 更新UI
                updateUserInfo(data.user);
                userInfoHeader.classList.remove('hidden');
                hideLoginModal();
            } else {
                console.error('Failed to fetch user info:', data.error);
                showLoginModal();
            }
        } catch (error) {
            console.error('Fetch user info failed:', error);
            showLoginModal();
        }
    }
    
    function updateUserInfo(user) {
        userName.textContent = user.realname || user.account || '用户';
        userEmail.textContent = user.email || '';
    }
    
    function showError(message) {
        // 简单的错误提示
        alert(message);
    }
    
    // --- NEW: Analysis Logic ---
    async function handleStartAnalysis() {
        // 检查登录状态
        if (!currentUser) {
            showLoginModal();
            return;
        }
        
        const transcript = interviewTranscript.value;
        if (!transcript.trim()) {
            alert('请输入面试全文内容！');
            return;
        }

        // 检查面试记录长度
        if (transcript.trim().length < 100) {
            alert('面试记录内容过短，请提供更详细的面试对话内容，以便AI进行准确评估！');
            return;
        }

        const competencyCards = resultsContainer.querySelectorAll('.competency-card');
        if (competencyCards.length === 0) {
            alert('请先生成岗位能力模型！');
            return;
        }

        // 先构建能力模型信息
        let competencyModelInfo = [];
        competencyCards.forEach(card => {
            const code = card.dataset.competencyCode;
            const level = card.querySelector('select').value;
            const competency = competenciesData[code];
            let fullDescription = "";
            const requiredLevelNum = parseInt(level.replace('L', ''));
            for (let i = 1; i <= requiredLevelNum; i++) {
                 fullDescription += `等级 ${i} (${competency.levels['L'+i].name}): ${competency.levels['L'+i].desc}\n`;
            }
            
            competencyModelInfo.push({
                name: competency.name,
                requiredLevel: `${level}: ${competency.levels[level].name}`,
                description: fullDescription
            });
        });
        
        analysisResultContainer.innerHTML = `
            <div class="bg-white rounded-lg shadow-lg p-6 border border-gray-200">
                <div class="text-center">
                    <button class="bg-gray-300 text-gray-700 font-bold py-3 px-8 rounded-lg transition shadow-lg cursor-not-allowed" disabled>
                        ⚡ AI分析中...
                    </button>
                </div>
            </div>
        `;

        const prompt = `
你是一位资深的HR专家和面试评估官，具备丰富的行为事件面试(BEI)评估经验。
你的任务是严格按照能力模型标准，对候选人进行客观、公正的能力评估。
评估时必须严格对照目标等级的行为要求，确保评分准确、依据充分。

【评估标准】
严格按照以下四个等级进行评估：

1. 符合要求 (Meets Expectations)
- 候选人通过具体行为事例，清晰展现了目标等级所要求的关键行为
- 行为表现与能力模型中目标等级的行为描述高度匹配
- 例子真实、具体且有说服力，能够证明其在该等级上具备稳定、可靠的能力水平
- 只有当存在充分证据证明达到目标等级时，才能评为"符合要求"

2. 超出要求 (Exceeds Expectations)  
- 候选人展现了高于目标等级的能力水平
- 行为的复杂度、思考深度、影响广度明显超越目标等级
- 体现了更高等级的行为特征

3. 低于要求 (Below Expectations)
- 候选人未能提供有效事例证明达到目标等级
- 提供的例子仅能证明远低于目标等级的能力水平
- 在面试官引导下仍无法阐述符合要求的行为

4. 没有展现 (Not Demonstrated)
- 面试中未收集到与该能力相关的有效信息
- 候选人明确表示"没有遇到过类似情况"
- 无法做出任何判断

【重要原则】
- 必须严格对照目标等级的行为要求进行评估
- 只有当存在充分证据证明达到目标等级时，才能评为"符合要求"
- 评估必须基于具体的行为证据，不能主观臆断
- 每个能力项必须提供充分的行为证据（至少3-5个证据）

【岗位能力模型】
${JSON.stringify(competencyModelInfo, null, 2)}

【面试文字记录】
${transcript}

【输出格式要求】
请严格按照以下JSON格式输出，对每个能力项进行单独评估：

{
  "assessments": [
    {
      "competencyName": "能力项名称",
      "targetLevel": "目标等级要求",
      "rating": "评分结果（超出要求/符合要求/低于要求/没有展现）",
      "evidences": [
        {
          "type": "证据类型（直接行为/结果导向/思维过程）",
          "content": "从面试记录中精准摘录的具体行为内容，必须用引号包围",
          "relevance": "与能力要求的关联性分析，详细说明该行为如何体现或未体现目标等级要求"
        }
      ],
      "behavioral_analysis": {
        "identified_behaviors": ["识别到的关键行为1", "关键行为2", "关键行为3"],
        "level_matching": "等级匹配分析：详细说明候选人的行为与目标等级要求的匹配程度，分析匹配和不匹配的地方",
        "gap_analysis": "差距分析：具体指出候选人与目标等级要求的差距在哪里，分析差距的原因",
        "conclusion_reasoning": "结论推理：基于充分证据的评分理由说明，详细解释为什么给出这个评分"
      },
      "strengths": ["该能力项的优势1", "优势2"],
      "improvements": ["该能力项的改进建议1", "改进建议2"]
    }
  ],
  "overall_summary": {
    "total_assessments": "总评估项数",
    "exceeds_count": "超出要求项数",
    "meets_count": "符合要求项数", 
    "below_count": "低于要求项数",
    "not_demonstrated_count": "没有展现项数"
  }
}

【质量要求】
1. 每个能力项必须提供充分的行为证据（至少3-5个证据）
2. AI分析与解读必须详细说明行为与等级要求的对应关系
3. 评分必须基于充分证据，严格对照目标等级要求
4. 确保输出格式完全正确，便于系统解析
5. 所有分析内容必须具体、深入，不能泛泛而谈
6. 证据必须从面试记录中精准摘录，不能随意编造
7. 等级匹配分析要详细对比候选人的行为与目标等级要求
8. 差距分析要具体指出差距在哪里，分析差距的原因
9. 结论推理要基于充分证据，详细解释评分理由
10. 必须对每个能力项进行单独评估，不能只给出整体评估
        `;

        try {
            let resultText = await callQwenAPIWithRetry(prompt);
            
            // 尝试解析JSON响应
            let data;
            try {
                // 清理可能的markdown格式
                if (resultText.startsWith("```json")) {
                    resultText = resultText.replace(/^```json\n?/, '').replace(/\n?```$/, '');
                } else if (resultText.startsWith("```")) {
                    resultText = resultText.replace(/^```\n?/, '').replace(/\n?```$/, '');
                }
                
                // 提取JSON部分
                const jsonMatch = resultText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    data = JSON.parse(jsonMatch[0]);
                } else {
                    data = JSON.parse(resultText);
                }
            } catch (parseError) {
                console.error("JSON解析错误:", parseError);
                analysisResultContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">AI返回的数据格式不正确，请重试。</div>`;
                return;
            }
            
            // 验证数据结构 - 支持多种格式
            if (!data.assessments && !data.score) {
                throw new Error("评估数据结构不正确");
            }
            
            // 添加调试信息
            console.log("=== 调试信息 ===");
            console.log("data:", data);
            
            if (data.assessments && Array.isArray(data.assessments)) {
                console.log("分项评估格式数据检测到:");
                console.log("data.assessments:", data.assessments);
                console.log("data.assessments.length:", data.assessments.length);
                console.log("data.overall_summary:", data.overall_summary);
            } else if (data.score && data.evidences) {
                console.log("整体评估格式数据检测到:");
                console.log("data.score:", data.score);
                console.log("data.evidences:", data.evidences);
                console.log("data.behavioral_analysis:", data.behavioral_analysis);
            } else if (data.assessments && data.assessments.length > 0 && data.assessments[0].behavioralEvidence) {
                console.log("旧版增强格式数据检测到:");
                console.log("data.assessments:", data.assessments);
            }
            
            // 渲染评估报告
            if (data.assessments && Array.isArray(data.assessments) && data.assessments.length > 0) {
                console.log("✅ 使用分项评估渲染函数");
                // 分项评估格式 - 使用新的分项渲染
                renderCompetencyBasedAnalysisReport(data);
            } else if (data.score && data.evidences && data.behavioral_analysis) {
                console.log("✅ 使用整体评估渲染函数");
                // 整体评估格式 - 使用整体渲染
                renderNewFormatAnalysisReport(data);
            } else if (data.assessments && data.assessments.length > 0 && data.assessments[0].behavioralEvidence) {
                console.log("✅ 使用增强版渲染函数");
                // 增强格式 - 使用增强版渲染
                renderEnhancedAnalysisReport(data);
            } else {
                console.log("⚠️ 使用兼容版渲染函数");
                // 旧格式 - 使用兼容版渲染
                renderAnalysisReport(data);
            }
            
        } catch (error) {
            console.error("Error during analysis:", error);
            analysisResultContainer.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-6 border border-red-200">
                    <div class="text-center">
                        <div class="text-4xl mb-4">❌</div>
                        <h3 class="text-lg font-semibold text-red-800 mb-2">评估失败</h3>
                        <p class="text-sm text-red-600 mb-4">AI分析过程中遇到问题，请检查以下可能的原因：</p>
                        <ul class="text-sm text-red-600 text-left max-w-md mx-auto space-y-1">
                            <li>• 面试记录内容是否足够详细</li>
                            <li>• 网络连接是否正常</li>
                            <li>• 是否已选择岗位和职级</li>
                        </ul>
                        <button onclick="location.reload()" class="mt-4 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
                            重新尝试
                        </button>
                    </div>
                </div>
            `;
        }
    }

    function renderAnalysisReport(data) {
        console.log("🔍 renderAnalysisReport 开始执行");
        console.log("传入的data:", data);
        
        const ratingStyles = {
            "超出要求": "bg-green-100 text-green-800 border-green-500",
            "符合要求": "bg-blue-100 text-blue-800 border-blue-500",
            "低于要求": "bg-yellow-100 text-yellow-800 border-yellow-500",
            "没有展现": "bg-gray-100 text-gray-800 border-gray-400"
        };

        const ratingIcons = {
            "超出要求": "🚀",
            "符合要求": "✅",
            "低于要求": "⚠️",
            "没有展现": "❓"
        };

        let html = `
            <div class="bg-white rounded-lg shadow-lg p-6 border border-gray-200">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">🤖 AI智能评估报告</h3>
                    <div class="text-sm text-gray-500">基于通义千问大模型分析</div>
                </div>
        `;

        // Summary Statistics
        const ratingCounts = {};
        data.assessments.forEach(item => {
            ratingCounts[item.rating] = (ratingCounts[item.rating] || 0) + 1;
        });

        html += `
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-green-50 p-3 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-600">${ratingCounts['超出要求'] || 0}</div>
                    <div class="text-sm text-green-700">超出要求</div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-600">${ratingCounts['符合要求'] || 0}</div>
                    <div class="text-sm text-blue-700">符合要求</div>
                </div>
                <div class="bg-yellow-50 p-3 rounded-lg text-center">
                    <div class="text-2xl font-bold text-yellow-600">${ratingCounts['低于要求'] || 0}</div>
                    <div class="text-sm text-yellow-700">低于要求</div>
                </div>
                <div class="bg-gray-50 p-3 rounded-lg text-center">
                    <div class="text-2xl font-bold text-gray-600">${ratingCounts['没有展现'] || 0}</div>
                    <div class="text-sm text-gray-700">没有展现</div>
                </div>
            </div>
        `;

        // Assessments
        html += '<div class="space-y-6">';
        data.assessments.forEach((item, index) => {
            const style = ratingStyles[item.rating] || "bg-gray-100 text-gray-800";
            const icon = ratingIcons[item.rating] || "❓";
            
            html += `
                <div class="border-l-4 p-6 rounded-r-lg ${style} shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${icon}</span>
                            <h4 class="font-bold text-lg">${item.competencyName}</h4>
                        </div>
                        <span class="font-semibold px-4 py-2 text-sm rounded-full flex-shrink-0 ${style} border">${item.rating}</span>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm font-semibold text-gray-700 mb-2">📋 关键行为证据</p>
                            <blockquote class="text-sm italic border-l-3 border-gray-400 pl-4 py-2 bg-gray-50 rounded-r-lg">
                                "${item.evidence}"
                            </blockquote>
                        </div>
                        
                        <div>
                            <p class="text-sm font-semibold text-gray-700 mb-2">🧠 AI分析与解读</p>
                            <div class="text-sm text-gray-700 leading-relaxed">
                                ${item.analysis}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';

        // Strengths and Weaknesses
        html += `
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border border-green-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">✅</span>
                        <h4 class="text-lg font-bold text-green-800">候选人优势</h4>
                    </div>
                    <div class="text-green-900 text-sm leading-relaxed whitespace-pre-line">${data.strengths}</div>
                </div>
                
                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-lg border border-yellow-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">⚠️</span>
                        <h4 class="text-lg font-bold text-yellow-800">有待提升</h4>
                    </div>
                    <div class="text-yellow-900 text-sm leading-relaxed whitespace-pre-line">${data.weaknesses}</div>
                </div>
            </div>
        `;

        // Footer
        html += `
            <div class="mt-6 pt-4 border-t border-gray-200 text-center text-sm text-gray-500">
                <p>💡 评估基于STAR原则和岗位能力模型，仅供参考。最终录用决策请结合实际情况综合判断。</p>
            </div>
        </div>
        `;

        analysisResultContainer.innerHTML = html;
    }



    function renderCompetencyBasedAnalysisReport(data) {
        console.log("🔍 renderCompetencyBasedAnalysisReport 开始执行");
        console.log("传入的data:", data);
        
        let html = '';

        // 评估总览区域 - 显示各等级统计
        html += renderCompetencyBasedEvaluationOverview(data);

        // 每个能力项的详细评估
        data.assessments.forEach((assessment, index) => {
            html += renderCompetencyAssessmentCard(assessment, index);
        });

        analysisResultContainer.innerHTML = html;
    }

    function renderNewFormatAnalysisReport(data) {
        console.log("🔍 renderNewFormatAnalysisReport 开始执行");
        console.log("传入的data:", data);
        
        let html = '';

        // 评估总览区域
        html += renderNewFormatEvaluationOverview(data);

        // 主要评估内容
        html += renderNewFormatMainContent(data);

        analysisResultContainer.innerHTML = html;
    }

    function renderEnhancedAnalysisReport(data) {
        console.log("🔍 renderEnhancedAnalysisReport 开始执行");
        console.log("传入的data:", data);
        
        let html = '';

        // 评估总览区域
        html += renderEvaluationOverview(data);

        // 每个能力项作为独立报告块
        data.assessments.forEach((item, index) => {
            html += renderCompetencyCard(item);
        });

        analysisResultContainer.innerHTML = html;
    }

    function renderCompetencyBasedEvaluationOverview(data) {
        const summary = data.overall_summary || {};
        const total = summary.total_assessments || data.assessments.length;
        const exceeds = summary.exceeds_count || 0;
        const meets = summary.meets_count || 0;
        const below = summary.below_count || 0;
        const notDemonstrated = summary.not_demonstrated_count || 0;

        return `
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">评估总览</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="bg-green-500 p-6 rounded-xl text-center shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-4xl mb-3">⭐</div>
                        <div class="text-3xl font-bold text-white mb-2">${exceeds}</div>
                        <div class="text-sm font-semibold text-white">超出要求</div>
                    </div>
                    <div class="bg-blue-500 p-6 rounded-xl text-center shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-4xl mb-3">✅</div>
                        <div class="text-3xl font-bold text-white mb-2">${meets}</div>
                        <div class="text-sm font-semibold text-white">符合要求</div>
                    </div>
                    <div class="bg-orange-500 p-6 rounded-xl text-center shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-4xl mb-3">⚠️</div>
                        <div class="text-3xl font-bold text-white mb-2">${below}</div>
                        <div class="text-sm font-semibold text-white">低于要求</div>
                    </div>
                    <div class="bg-gray-500 p-6 rounded-xl text-center shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-4xl mb-3">⭕</div>
                        <div class="text-3xl font-bold text-white mb-2">${notDemonstrated}</div>
                        <div class="text-sm font-semibold text-white">没有展现</div>
                    </div>
                </div>
                <div class="mt-6 text-center text-sm text-gray-600 font-medium">
                    共评估 ${total} 项能力
                </div>
            </div>
        `;
    }

    function renderNewFormatEvaluationOverview(data) {
        const score = data.score;
        const scoreIcon = {
            "超出要求": "⭐",
            "符合要求": "✅",
            "低于要求": "⚠️",
            "没有展现": "⭕"
        }[score] || "❓";

        const scoreColor = {
            "超出要求": "green",
            "符合要求": "blue",
            "低于要求": "orange",
            "没有展现": "gray"
        }[score] || "gray";

        return `
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">评估总览</h3>
                <div class="flex justify-center">
                    <div class="bg-gradient-to-br from-${scoreColor}-50 to-${scoreColor}-100 p-8 rounded-xl text-center border-2 border-${scoreColor}-200 shadow-lg">
                        <div class="text-5xl mb-4">${scoreIcon}</div>
                        <div class="text-4xl font-bold text-${scoreColor}-700 mb-3">${score}</div>
                        <div class="text-lg font-semibold text-${scoreColor}-800">整体评估结果</div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderCompetencyAssessmentCard(assessment, index) {
        const ratingTag = getRatingTagStyle(assessment.rating);
        
        return `
            <div class="bg-white rounded-xl shadow-lg mb-8 hover:shadow-xl transition-shadow duration-300 border border-gray-200">
                <div class="flex justify-between items-center p-6 border-b border-gray-100">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${assessment.competencyName}</h3>
                        <p class="text-sm text-gray-500 font-medium">目标等级: ${assessment.targetLevel}</p>
                    </div>
                    <span class="${ratingTag}">${assessment.rating}</span>
                </div>
                
                <div class="p-6">
                    ${renderAssessmentEvidences(assessment.evidences)}
                    ${renderAssessmentBehavioralAnalysis(assessment.behavioral_analysis)}
                    ${renderAssessmentStrengthsImprovements(assessment)}
                </div>
            </div>
        `;
    }

    function renderAssessmentEvidences(evidences) {
        if (!evidences || evidences.length === 0) return '';
        
        return `
            <div class="mb-8">
                <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-blue-600 mr-3 text-2xl">□</span>
                    关键行为证据
                </h4>
                <div class="space-y-4">
                    ${evidences.map((evidence, index) => `
                        <div class="bg-blue-50 border-l-4 border-blue-500 pl-4 py-3 rounded-r-lg">
                            <h5 class="text-base font-semibold text-gray-800 mb-2 flex items-center">
                                <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full mr-3">${index + 1}</span>
                                ${evidence.type} 证据
                            </h5>
                            <div class="mb-2">
                                <p class="text-sm font-semibold text-gray-700 mb-1">证据内容:</p>
                                <blockquote class="text-sm italic border-l-2 border-gray-400 pl-3 py-1 text-gray-700 leading-tight">
                                    ${evidence.content}
                                </blockquote>
                            </div>
                            <div class="mb-1">
                                <p class="text-sm font-semibold text-gray-700 mb-1">AI分析与解读:</p>
                                <p class="text-sm text-gray-700 leading-tight">${evidence.relevance}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderAssessmentBehavioralAnalysis(analysis) {
        if (!analysis) return '';
        
        return `
            <div class="mb-8">
                <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-purple-600 mr-3 text-2xl">●</span>
                    AI行为解码分析
                </h4>
                <div class="bg-purple-50 p-6 rounded-xl">
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-2">识别到的关键行为:</h5>
                        <div class="flex flex-wrap gap-2">
                            ${(analysis.identified_behaviors || []).map(behavior => 
                                `<span class="inline-block bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium">${behavior}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">等级匹配分析:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${analysis.level_matching || ''}</p>
                    </div>
                    
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">差距分析:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${analysis.gap_analysis || ''}</p>
                    </div>
                    
                    <div class="mb-1">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">结论推理:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${analysis.conclusion_reasoning || ''}</p>
                    </div>
                </div>
            </div>
        `;
    }

    function renderAssessmentStrengthsImprovements(assessment) {
        return `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-3 text-green-600">●</span>
                        <h4 class="text-lg font-bold text-green-800">优势</h4>
                    </div>
                    <ul class="text-green-900 text-sm space-y-1">
                        ${(assessment.strengths || []).map(strength => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-green-600">•</span>
                                <span class="leading-tight">${strength}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
                
                <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-3 text-orange-600">▲</span>
                        <h4 class="text-lg font-bold text-orange-800">改进建议</h4>
                    </div>
                    <ul class="text-orange-900 text-sm space-y-1">
                        ${(assessment.improvements || []).map(improvement => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-orange-600">•</span>
                                <span class="leading-tight">${improvement}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        `;
    }

    function renderNewFormatMainContent(data) {
        return `
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">关键行为证据</h3>
                <div class="space-y-4">
                    ${data.evidences.map((evidence, index) => `
                        <div class="bg-blue-50 border-l-4 border-blue-500 pl-4 py-3 rounded-r-lg">
                            <h4 class="text-base font-semibold text-gray-800 mb-2 flex items-center">
                                <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full mr-3">${index + 1}</span>
                                ${evidence.type} 证据
                            </h4>
                            <div class="mb-2">
                                <p class="text-sm font-semibold text-gray-700 mb-1">证据内容:</p>
                                <blockquote class="text-sm italic border-l-2 border-gray-400 pl-3 py-1 text-gray-700 leading-tight">
                                    ${evidence.content}
                                </blockquote>
                            </div>
                            <div class="mb-1">
                                <p class="text-sm font-semibold text-gray-700 mb-1">AI分析与解读:</p>
                                <p class="text-sm text-gray-700 leading-tight">${evidence.relevance}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">AI行为解码分析</h3>
                <div class="bg-purple-50 p-6 rounded-xl">
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-2">识别到的关键行为:</h5>
                        <div class="flex flex-wrap gap-2">
                            ${data.behavioral_analysis.identified_behaviors.map(behavior => 
                                `<span class="inline-block bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium">${behavior}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">等级匹配分析:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${data.behavioral_analysis.level_matching}</p>
                    </div>
                    
                    <div class="mb-3">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">差距分析:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${data.behavioral_analysis.gap_analysis}</p>
                    </div>
                    
                    <div class="mb-1">
                        <h5 class="text-base font-semibold text-gray-800 mb-1">结论推理:</h5>
                        <p class="text-sm text-gray-700 leading-tight">${data.behavioral_analysis.conclusion_reasoning}</p>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-3 text-green-600">●</span>
                        <h4 class="text-lg font-bold text-green-800">优势</h4>
                    </div>
                    <ul class="text-green-900 text-sm space-y-1">
                        ${data.strengths.map(strength => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-green-600">•</span>
                                <span class="leading-tight">${strength}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
                
                <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-3 text-orange-600">▲</span>
                        <h4 class="text-lg font-bold text-orange-800">改进建议</h4>
                    </div>
                    <ul class="text-orange-900 text-sm space-y-1">
                        ${data.improvements.map(improvement => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-orange-600">•</span>
                                <span class="leading-tight">${improvement}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        `;
    }

    function renderEvaluationOverview(data) {
        const ratingCounts = {};
        data.assessments.forEach(item => {
            ratingCounts[item.rating] = (ratingCounts[item.rating] || 0) + 1;
        });

        return `
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">评估总览</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-green-50 p-4 rounded-lg text-center border border-green-200">
                        <div class="text-3xl mb-2">⭐</div>
                        <div class="text-2xl font-bold text-green-600">${ratingCounts['超出要求'] || 0}</div>
                        <div class="text-sm text-green-700">超出要求</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center border border-blue-200">
                        <div class="text-3xl mb-2">✅</div>
                        <div class="text-2xl font-bold text-blue-600">${ratingCounts['符合要求'] || 0}</div>
                        <div class="text-sm text-blue-700">符合要求</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center border border-orange-200">
                        <div class="text-3xl mb-2">⚠️</div>
                        <div class="text-2xl font-bold text-orange-600">${ratingCounts['低于要求'] || 0}</div>
                        <div class="text-sm text-orange-700">低于要求</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                        <div class="text-3xl mb-2">⭕</div>
                        <div class="text-2xl font-bold text-gray-600">${ratingCounts['没有展现'] || 0}</div>
                        <div class="text-sm text-gray-700">没有展现</div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderCompetencyCard(item) {
        const ratingTag = getRatingTagStyle(item.rating);
        
        return `
            <div class="bg-white rounded-lg shadow-lg mb-8 border border-gray-200">
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">${item.competencyName}</h3>
                        <p class="text-sm text-gray-600 mt-1">目标等级: ${item.targetLevel}</p>
                    </div>
                    <span class="${ratingTag}">${item.rating}</span>
                </div>
                
                <div class="p-6">
                    ${renderBehavioralEvidence(item.behavioralEvidence)}
                    ${renderDecodingAnalysis(item.levelMatchingAnalysis)}
                    ${renderStrengthsSuggestions(item)}
                </div>
            </div>
        `;
    }

    function renderBehavioralEvidenceSection(titlePrefix, evidenceArray, sectionIndex) {
        if (!evidenceArray || evidenceArray.length === 0) return '';

        let evidenceItemsHtml = '';
        evidenceArray.forEach((item, index) => {
            evidenceItemsHtml += `
                <div class="mb-3">
                    <p class="text-sm font-semibold">证据${index + 1}:</p>
                    <blockquote class="mt-1 text-sm italic border-l-2 border-gray-400 pl-2 text-gray-600">
                        "${item.evidence}"
                    </blockquote>
                    <p class="text-sm font-semibold mt-3">AI分析与解读:</p>
                    <p class="mt-1 text-sm text-gray-700">${item.analysis}</p>
                </div>
            `;
        });

        return `
            <div class="mb-6">
                <h5 class="text-md font-semibold text-gray-700 mb-3">${titlePrefix} 证据${sectionIndex}</h5>
                <div class="space-y-3">
                    ${evidenceItemsHtml}
                </div>
            </div>
        `;
    }

    function renderBehavioralEvidence(evidence) {
        return `
            <div class="mb-8">
                <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-blue-600 mr-2">□</span>
                    关键行为证据
                </h4>
                <div class="space-y-6">
                    ${renderEvidenceSection('直接行为', evidence?.directBehavior || [], 1)}
                    ${renderEvidenceSection('结果导向', evidence?.resultOriented || [], 2)}
                    ${renderEvidenceSection('思维过程', evidence?.thinkingProcess || [], 3)}
                </div>
            </div>
        `;
    }

    function renderEvidenceSection(title, evidenceArray, index) {
        if (!evidenceArray || evidenceArray.length === 0) return '';
        
        let html = '';
        evidenceArray.forEach((item, i) => {
            html += `
                <div class="mb-4">
                    <h5 class="text-md font-semibold text-gray-700 mb-3">${title} 证据${index}</h5>
                    <div class="mb-3">
                        <p class="text-sm font-semibold text-gray-700">证据${i + 1}:</p>
                        <blockquote class="mt-1 text-sm italic border-l-2 border-gray-400 pl-2 text-gray-600 bg-gray-50 rounded-r-lg py-2">
                            "${item.evidence}"
                        </blockquote>
                    </div>
                    <div class="mb-3">
                        <p class="text-sm font-semibold text-gray-700">AI分析与解读:</p>
                        <p class="mt-1 text-sm text-gray-700 leading-relaxed">${item.analysis}</p>
                    </div>
                </div>
            `;
        });
        
        return html;
    }

    function renderDecodingAnalysis(analysis) {
        return `
            <div class="mb-8">
                <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-purple-600 mr-2">●</span>
                    AI行为解码分析
                </h4>
                <div class="space-y-6">
                    ${renderIdentifiedBehaviors(analysis?.identifiedBehaviors || [])}
                    ${renderAnalysisSection('等级匹配分析', analysis?.levelRequirement || '')}
                    ${renderAnalysisSection('匹配程度分析', analysis?.matchingDegree || '')}
                    ${renderAnalysisSection('差距分析', analysis?.gapAnalysis || '')}
                    ${renderAnalysisSection('结论推理', analysis?.conclusionReasoning || '')}
                </div>
            </div>
        `;
    }

    function renderIdentifiedBehaviors(behaviors) {
        if (!behaviors || behaviors.length === 0) return '';
        
        const behaviorTags = behaviors.map(behavior => 
            `<span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm mr-2 mb-2">${behavior}</span>`
        ).join('');
        
        return `
            <div class="mb-4">
                <h5 class="text-md font-semibold text-gray-700 mb-2">识别到的关键行为:</h5>
                <div class="flex flex-wrap">
                    ${behaviorTags}
                </div>
            </div>
        `;
    }

    function renderAnalysisSection(title, content) {
        if (!content) return '';
        
        return `
            <div class="mb-4">
                <h5 class="text-md font-semibold text-gray-700 mb-2">${title}:</h5>
                <p class="text-sm text-gray-700 leading-relaxed">${content}</p>
            </div>
        `;
    }

    function renderStrengthsSuggestions(item) {
        return `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-2">●</span>
                        <h4 class="text-lg font-bold text-green-800">优势</h4>
                    </div>
                    <ul class="text-green-900 text-sm space-y-1">
                        ${(item.strengths || []).map(strength => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-green-600">•</span>
                                <span class="leading-tight">${strength}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
                
                <div class="bg-orange-50 p-6 rounded-lg border border-orange-200">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-2">▲</span>
                        <h4 class="text-lg font-bold text-orange-800">改进建议</h4>
                    </div>
                    <ul class="text-orange-900 text-sm space-y-1">
                        ${(item.developmentSuggestions || []).map(suggestion => 
                            `<li class="flex items-start py-1">
                                <span class="mr-2 text-orange-600">•</span>
                                <span class="leading-tight">${suggestion}</span>
                            </li>`
                        ).join('')}
                    </ul>
                </div>
            </div>
        `;
    }

    function renderDecodingSubSection(title, content, type) {
        if (!content || (Array.isArray(content) && content.length === 0)) return '';

        let contentHtml = '';
        if (type === 'list') {
            contentHtml = `<ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">`;
            content.forEach(item => {
                contentHtml += `<li>${item}</li>`;
            });
            contentHtml += `</ul>`;
        } else { // paragraph
            contentHtml = `<p class="text-sm text-gray-700 leading-relaxed">${content}</p>`;
        }

        let titleHtml = '';
        if (title === '识别到的关键行为') {
            titleHtml = `<h5 class="text-md font-semibold text-gray-700 mb-2">${title}</h5>`;
        } else {
            titleHtml = `<h5 class="text-md font-semibold text-gray-700 mb-2">${title}</h5>`;
        }

        return `
            <div class="mb-4">
                ${titleHtml}
                ${contentHtml}
            </div>
        `;
    }

    function getCompetencyStrengths(item) {
        // 从整体评估中提取与该能力项相关的优势
        // 这里可以根据能力项名称进行匹配，暂时返回通用优势
        return [
            "具备良好的问题分析能力",
            "能够有效收集和处理用户反馈",
            "具备一定的项目执行能力"
        ];
    }

    function getCompetencySuggestions(item) {
        // 从整体评估中提取与该能力项相关的建议
        // 这里可以根据能力项名称进行匹配，暂时返回通用建议
        return [
            "建议加强相关理论知识的学习",
            "鼓励参与更多实践项目",
            "建议提升系统化思维能力"
        ];
    }

    function renderStrengthsSuggestionsSection(title, itemsArray, color, icon) {
        if (!itemsArray || itemsArray.length === 0) return '';

        let listHtml = `<ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">`;
        itemsArray.forEach(item => {
            listHtml += `<li>${item}</li>`;
        });
        listHtml += `</ul>`;

        const colorClasses = {
            'green': 'text-green-800',
            'blue': 'text-blue-800',
            'orange': 'text-orange-800'
        };

        return `
            <div class="bg-gradient-to-br from-${color}-50 to-${color}-100 p-6 rounded-lg border border-${color}-200">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-2">${icon}</span>
                    <h4 class="text-lg font-bold ${colorClasses[color]}">${title}</h4>
                </div>
                <div class="space-y-4">
                    ${listHtml}
                </div>
            </div>
        `;
    }



    function getRatingTagStyle(rating) {
        const styles = {
            "超出要求": "bg-gradient-to-r from-green-100 to-green-200 text-green-800 px-6 py-3 rounded-full text-sm font-bold border-2 border-green-300 shadow-sm",
            "符合要求": "bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 px-6 py-3 rounded-full text-sm font-bold border-2 border-blue-300 shadow-sm",
            "低于要求": "bg-gradient-to-r from-orange-100 to-orange-200 text-orange-800 px-6 py-3 rounded-full text-sm font-bold border-2 border-orange-300 shadow-sm",
            "没有展现": "bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 px-6 py-3 rounded-full text-sm font-bold border-2 border-gray-300 shadow-sm"
        };
        return styles[rating] || "bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 px-6 py-3 rounded-full text-sm font-bold border-2 border-gray-300 shadow-sm";
    }


    // --- Start the application ---
    init();
});

</script>
</body>
</html>
